<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reactor - 高级特性与概念 | Haoyuan&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <noscript><meta http-equiv="refresh" content="0; url=/noscript.html"><style>.theme-vdoing-content { display:none }</style></noscript>
    <script src="https://cdn.jsdelivr.net/npm/twikoo@1.6.41/dist/twikoo.all.min.js"></script>
    <script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?720c7013e4bdca4370c380ffa206fbd7";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script>
    <meta name="description" content="Somnus Haoyuan个人博客, VuePress搭建, 使用了 Vdoing 主题, 学习Java, AI大模型等相关知识, 记录生活和技术路程, 同时分享编程技巧。">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="Web个人学习博客，学习是一件快乐的事情。">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.6aa5acdd.css" as="style"><link rel="preload" href="/assets/js/app.40d6eb57.js" as="script"><link rel="preload" href="/assets/js/2.84f16386.js" as="script"><link rel="preload" href="/assets/js/248.5a48e87f.js" as="script"><link rel="preload" href="/assets/js/15.107d5767.js" as="script"><link rel="preload" href="/assets/js/5.1ffba6c1.js" as="script"><link rel="preload" href="/assets/js/9.dba8a9bf.js" as="script"><link rel="preload" href="/assets/js/12.3f1ed9aa.js" as="script"><link rel="prefetch" href="/assets/js/10.2faf032d.js"><link rel="prefetch" href="/assets/js/100.20bf2323.js"><link rel="prefetch" href="/assets/js/101.58e9195d.js"><link rel="prefetch" href="/assets/js/102.934f4e2d.js"><link rel="prefetch" href="/assets/js/103.2e1edf2f.js"><link rel="prefetch" href="/assets/js/104.f11cb866.js"><link rel="prefetch" href="/assets/js/105.f031400c.js"><link rel="prefetch" href="/assets/js/106.8c306f6f.js"><link rel="prefetch" href="/assets/js/107.4cbb12e2.js"><link rel="prefetch" href="/assets/js/108.013594b5.js"><link rel="prefetch" href="/assets/js/109.855fb1f7.js"><link rel="prefetch" href="/assets/js/11.8d4c884c.js"><link rel="prefetch" href="/assets/js/110.169f17cd.js"><link rel="prefetch" href="/assets/js/111.f3bffe9c.js"><link rel="prefetch" href="/assets/js/112.b05741ea.js"><link rel="prefetch" href="/assets/js/113.c4ea6307.js"><link rel="prefetch" href="/assets/js/114.70c200f9.js"><link rel="prefetch" href="/assets/js/115.10d6bcd7.js"><link rel="prefetch" href="/assets/js/116.0929f9ea.js"><link rel="prefetch" href="/assets/js/117.61aa7090.js"><link rel="prefetch" href="/assets/js/118.eccb075c.js"><link rel="prefetch" href="/assets/js/119.fef47816.js"><link rel="prefetch" href="/assets/js/120.372cb96d.js"><link rel="prefetch" href="/assets/js/121.2560116c.js"><link rel="prefetch" href="/assets/js/122.726e3fde.js"><link rel="prefetch" href="/assets/js/123.6de6a113.js"><link rel="prefetch" href="/assets/js/124.d52d8b46.js"><link rel="prefetch" href="/assets/js/125.409b7367.js"><link rel="prefetch" href="/assets/js/126.c4e734c2.js"><link rel="prefetch" href="/assets/js/127.13e37428.js"><link rel="prefetch" href="/assets/js/128.f035adf7.js"><link rel="prefetch" href="/assets/js/129.fefb2424.js"><link rel="prefetch" href="/assets/js/13.06f0d806.js"><link rel="prefetch" href="/assets/js/130.bb7d196c.js"><link rel="prefetch" href="/assets/js/131.7850d655.js"><link rel="prefetch" href="/assets/js/132.1009bf67.js"><link rel="prefetch" href="/assets/js/133.a61ca829.js"><link rel="prefetch" href="/assets/js/134.83670718.js"><link rel="prefetch" href="/assets/js/135.476146e2.js"><link rel="prefetch" href="/assets/js/136.1593b8d9.js"><link rel="prefetch" href="/assets/js/137.9bc3b9a4.js"><link rel="prefetch" href="/assets/js/138.05c298a8.js"><link rel="prefetch" href="/assets/js/139.baa0f361.js"><link rel="prefetch" href="/assets/js/14.e8a14911.js"><link rel="prefetch" href="/assets/js/140.f7a1498f.js"><link rel="prefetch" href="/assets/js/141.d1117262.js"><link rel="prefetch" href="/assets/js/142.b990b892.js"><link rel="prefetch" href="/assets/js/143.3e0e3d6c.js"><link rel="prefetch" href="/assets/js/144.3c99f5d1.js"><link rel="prefetch" href="/assets/js/145.9efc9743.js"><link rel="prefetch" href="/assets/js/146.1b85bb65.js"><link rel="prefetch" href="/assets/js/147.552bbe6f.js"><link rel="prefetch" href="/assets/js/148.38c079c9.js"><link rel="prefetch" href="/assets/js/149.8a32fdf3.js"><link rel="prefetch" href="/assets/js/150.d73e6d70.js"><link rel="prefetch" href="/assets/js/151.139e669e.js"><link rel="prefetch" href="/assets/js/152.6fe2e61f.js"><link rel="prefetch" href="/assets/js/153.e88f4410.js"><link rel="prefetch" href="/assets/js/154.143abe60.js"><link rel="prefetch" href="/assets/js/155.35c81a23.js"><link rel="prefetch" href="/assets/js/156.f0e2d6ad.js"><link rel="prefetch" href="/assets/js/157.468fb051.js"><link rel="prefetch" href="/assets/js/158.cd86d09f.js"><link rel="prefetch" href="/assets/js/159.833f916a.js"><link rel="prefetch" href="/assets/js/16.f07b2571.js"><link rel="prefetch" href="/assets/js/160.aa4c01ba.js"><link rel="prefetch" href="/assets/js/161.bbc9ee08.js"><link rel="prefetch" href="/assets/js/162.41293d9d.js"><link rel="prefetch" href="/assets/js/163.cbfb7d74.js"><link rel="prefetch" href="/assets/js/164.aad4d4b8.js"><link rel="prefetch" href="/assets/js/165.3b69b465.js"><link rel="prefetch" href="/assets/js/166.646fb23c.js"><link rel="prefetch" href="/assets/js/167.c874eb18.js"><link rel="prefetch" href="/assets/js/168.cf29dd2c.js"><link rel="prefetch" href="/assets/js/169.d10f2b80.js"><link rel="prefetch" href="/assets/js/17.84d94fc1.js"><link rel="prefetch" href="/assets/js/170.69f2f0de.js"><link rel="prefetch" href="/assets/js/171.d05e324a.js"><link rel="prefetch" href="/assets/js/172.213b6735.js"><link rel="prefetch" href="/assets/js/173.bdb037f2.js"><link rel="prefetch" href="/assets/js/174.90dd7a19.js"><link rel="prefetch" href="/assets/js/175.65e79e89.js"><link rel="prefetch" href="/assets/js/176.6e21166e.js"><link rel="prefetch" href="/assets/js/177.efb7d4d2.js"><link rel="prefetch" href="/assets/js/178.2500c230.js"><link rel="prefetch" href="/assets/js/179.9d6c29aa.js"><link rel="prefetch" href="/assets/js/18.bb0be2bd.js"><link rel="prefetch" href="/assets/js/180.8935ec8e.js"><link rel="prefetch" href="/assets/js/181.0ba3667a.js"><link rel="prefetch" href="/assets/js/182.1527192a.js"><link rel="prefetch" href="/assets/js/183.e32e0b1a.js"><link rel="prefetch" href="/assets/js/184.f16730e1.js"><link rel="prefetch" href="/assets/js/185.6817fe7e.js"><link rel="prefetch" href="/assets/js/186.06f91832.js"><link rel="prefetch" href="/assets/js/187.b2e68c56.js"><link rel="prefetch" href="/assets/js/188.c459a7b2.js"><link rel="prefetch" href="/assets/js/189.c5dc9c9a.js"><link rel="prefetch" href="/assets/js/19.babf254d.js"><link rel="prefetch" href="/assets/js/190.539ad7b9.js"><link rel="prefetch" href="/assets/js/191.d4fa3d3f.js"><link rel="prefetch" href="/assets/js/192.904f7b4f.js"><link rel="prefetch" href="/assets/js/193.cc14cf04.js"><link rel="prefetch" href="/assets/js/194.11881e6e.js"><link rel="prefetch" href="/assets/js/195.78172201.js"><link rel="prefetch" href="/assets/js/196.79388c52.js"><link rel="prefetch" href="/assets/js/197.93ca4c41.js"><link rel="prefetch" href="/assets/js/198.452abacb.js"><link rel="prefetch" href="/assets/js/199.6ef2d196.js"><link rel="prefetch" href="/assets/js/20.5e77ec48.js"><link rel="prefetch" href="/assets/js/200.0656fb6f.js"><link rel="prefetch" href="/assets/js/201.19f892f2.js"><link rel="prefetch" href="/assets/js/202.ece43be4.js"><link rel="prefetch" href="/assets/js/203.d5298504.js"><link rel="prefetch" href="/assets/js/204.3d2dc50d.js"><link rel="prefetch" href="/assets/js/205.d24257e6.js"><link rel="prefetch" href="/assets/js/206.bacdf227.js"><link rel="prefetch" href="/assets/js/207.6fd49f37.js"><link rel="prefetch" href="/assets/js/208.c4d1371e.js"><link rel="prefetch" href="/assets/js/209.efc2bdb7.js"><link rel="prefetch" href="/assets/js/21.b614b7ce.js"><link rel="prefetch" href="/assets/js/210.ff884ca2.js"><link rel="prefetch" href="/assets/js/211.579d567a.js"><link rel="prefetch" href="/assets/js/212.b23d9c7a.js"><link rel="prefetch" href="/assets/js/213.f972e645.js"><link rel="prefetch" href="/assets/js/214.677ab8e4.js"><link rel="prefetch" href="/assets/js/215.8317429b.js"><link rel="prefetch" href="/assets/js/216.fe793ca1.js"><link rel="prefetch" href="/assets/js/217.d15bd553.js"><link rel="prefetch" href="/assets/js/218.f2476c1a.js"><link rel="prefetch" href="/assets/js/219.5de46d42.js"><link rel="prefetch" href="/assets/js/22.e14f8d0d.js"><link rel="prefetch" href="/assets/js/220.c49bbd40.js"><link rel="prefetch" href="/assets/js/221.4004aa7d.js"><link rel="prefetch" href="/assets/js/222.5d16df13.js"><link rel="prefetch" href="/assets/js/223.cb628b00.js"><link rel="prefetch" href="/assets/js/224.a6d24d03.js"><link rel="prefetch" href="/assets/js/225.d2bacd2b.js"><link rel="prefetch" href="/assets/js/226.8d5b24c0.js"><link rel="prefetch" href="/assets/js/227.76f901fc.js"><link rel="prefetch" href="/assets/js/228.9fe5796a.js"><link rel="prefetch" href="/assets/js/229.441566ae.js"><link rel="prefetch" href="/assets/js/23.ffcd828d.js"><link rel="prefetch" href="/assets/js/230.af5be7d3.js"><link rel="prefetch" href="/assets/js/231.836eacb5.js"><link rel="prefetch" href="/assets/js/232.e71d875f.js"><link rel="prefetch" href="/assets/js/233.c0f4811a.js"><link rel="prefetch" href="/assets/js/234.393292da.js"><link rel="prefetch" href="/assets/js/235.f0410328.js"><link rel="prefetch" href="/assets/js/236.c8e24b2a.js"><link rel="prefetch" href="/assets/js/237.c7511291.js"><link rel="prefetch" href="/assets/js/238.dcf9d74f.js"><link rel="prefetch" href="/assets/js/239.89c3f7fb.js"><link rel="prefetch" href="/assets/js/24.d2488dd7.js"><link rel="prefetch" href="/assets/js/240.6a231b35.js"><link rel="prefetch" href="/assets/js/241.9518dd8b.js"><link rel="prefetch" href="/assets/js/242.49fee092.js"><link rel="prefetch" href="/assets/js/243.99b57f78.js"><link rel="prefetch" href="/assets/js/244.dffff977.js"><link rel="prefetch" href="/assets/js/245.cdcb59f8.js"><link rel="prefetch" href="/assets/js/246.ee61d776.js"><link rel="prefetch" href="/assets/js/247.03b13721.js"><link rel="prefetch" href="/assets/js/249.cd1b3546.js"><link rel="prefetch" href="/assets/js/25.c4ac0557.js"><link rel="prefetch" href="/assets/js/250.204cda9d.js"><link rel="prefetch" href="/assets/js/251.cf5a43ea.js"><link rel="prefetch" href="/assets/js/252.e87cba9e.js"><link rel="prefetch" href="/assets/js/253.31cd4b77.js"><link rel="prefetch" href="/assets/js/254.bc198d0d.js"><link rel="prefetch" href="/assets/js/255.555f461c.js"><link rel="prefetch" href="/assets/js/256.35549c82.js"><link rel="prefetch" href="/assets/js/257.eb8b7f14.js"><link rel="prefetch" href="/assets/js/258.079163a3.js"><link rel="prefetch" href="/assets/js/259.855bf637.js"><link rel="prefetch" href="/assets/js/26.bbaa3da7.js"><link rel="prefetch" href="/assets/js/260.8dbdaa34.js"><link rel="prefetch" href="/assets/js/261.3a3a3d48.js"><link rel="prefetch" href="/assets/js/262.ff4335e2.js"><link rel="prefetch" href="/assets/js/263.4e2cc7b6.js"><link rel="prefetch" href="/assets/js/264.8bf179e4.js"><link rel="prefetch" href="/assets/js/265.a0d8d94a.js"><link rel="prefetch" href="/assets/js/266.c7cb4303.js"><link rel="prefetch" href="/assets/js/267.cd833024.js"><link rel="prefetch" href="/assets/js/268.18023bf7.js"><link rel="prefetch" href="/assets/js/269.d698565e.js"><link rel="prefetch" href="/assets/js/27.cbc4cccc.js"><link rel="prefetch" href="/assets/js/270.4f42ac21.js"><link rel="prefetch" href="/assets/js/271.01513156.js"><link rel="prefetch" href="/assets/js/272.89b02542.js"><link rel="prefetch" href="/assets/js/273.d97ca2b8.js"><link rel="prefetch" href="/assets/js/274.2d44453c.js"><link rel="prefetch" href="/assets/js/275.0454b122.js"><link rel="prefetch" href="/assets/js/276.2a798428.js"><link rel="prefetch" href="/assets/js/277.1b773039.js"><link rel="prefetch" href="/assets/js/278.85318522.js"><link rel="prefetch" href="/assets/js/279.0b9b7dd0.js"><link rel="prefetch" href="/assets/js/28.2811fe35.js"><link rel="prefetch" href="/assets/js/280.34d99bb9.js"><link rel="prefetch" href="/assets/js/281.50efe138.js"><link rel="prefetch" href="/assets/js/282.730115fe.js"><link rel="prefetch" href="/assets/js/283.51e62999.js"><link rel="prefetch" href="/assets/js/284.a366d7e9.js"><link rel="prefetch" href="/assets/js/285.9f0bb34b.js"><link rel="prefetch" href="/assets/js/286.723a14e7.js"><link rel="prefetch" href="/assets/js/287.787b390a.js"><link rel="prefetch" href="/assets/js/288.3eab7c63.js"><link rel="prefetch" href="/assets/js/289.eb4897c8.js"><link rel="prefetch" href="/assets/js/29.553c7a36.js"><link rel="prefetch" href="/assets/js/290.3f12b330.js"><link rel="prefetch" href="/assets/js/291.aecfc068.js"><link rel="prefetch" href="/assets/js/292.cf2ea18c.js"><link rel="prefetch" href="/assets/js/293.a7576751.js"><link rel="prefetch" href="/assets/js/294.59a2ea07.js"><link rel="prefetch" href="/assets/js/295.21aafb3b.js"><link rel="prefetch" href="/assets/js/296.9d03ef74.js"><link rel="prefetch" href="/assets/js/297.e5333eaa.js"><link rel="prefetch" href="/assets/js/298.6b331403.js"><link rel="prefetch" href="/assets/js/299.aed7fe75.js"><link rel="prefetch" href="/assets/js/3.91d9010e.js"><link rel="prefetch" href="/assets/js/30.f752542d.js"><link rel="prefetch" href="/assets/js/300.4b43249a.js"><link rel="prefetch" href="/assets/js/301.8a2d29aa.js"><link rel="prefetch" href="/assets/js/302.2ebd826a.js"><link rel="prefetch" href="/assets/js/303.4bf03f68.js"><link rel="prefetch" href="/assets/js/304.842e0021.js"><link rel="prefetch" href="/assets/js/305.0689927e.js"><link rel="prefetch" href="/assets/js/306.9fe73451.js"><link rel="prefetch" href="/assets/js/307.d6dfc95b.js"><link rel="prefetch" href="/assets/js/308.f6b5fa22.js"><link rel="prefetch" href="/assets/js/309.f0a9e8bf.js"><link rel="prefetch" href="/assets/js/31.efc35430.js"><link rel="prefetch" href="/assets/js/310.b6a97346.js"><link rel="prefetch" href="/assets/js/311.e09ede20.js"><link rel="prefetch" href="/assets/js/312.9ede7559.js"><link rel="prefetch" href="/assets/js/313.70d997db.js"><link rel="prefetch" href="/assets/js/314.8f1cb40a.js"><link rel="prefetch" href="/assets/js/315.3dcbc212.js"><link rel="prefetch" href="/assets/js/316.503dd0d9.js"><link rel="prefetch" href="/assets/js/317.a2628cdc.js"><link rel="prefetch" href="/assets/js/318.79498962.js"><link rel="prefetch" href="/assets/js/319.6383a4d8.js"><link rel="prefetch" href="/assets/js/32.2e7f0ecf.js"><link rel="prefetch" href="/assets/js/320.df7b195d.js"><link rel="prefetch" href="/assets/js/321.a3a665d5.js"><link rel="prefetch" href="/assets/js/322.5f4bb853.js"><link rel="prefetch" href="/assets/js/323.08fc2754.js"><link rel="prefetch" href="/assets/js/324.2ee64ecf.js"><link rel="prefetch" href="/assets/js/325.0645a604.js"><link rel="prefetch" href="/assets/js/326.510326c5.js"><link rel="prefetch" href="/assets/js/327.58ead103.js"><link rel="prefetch" href="/assets/js/328.9c763bc9.js"><link rel="prefetch" href="/assets/js/329.8d27c776.js"><link rel="prefetch" href="/assets/js/33.0fb3ddd2.js"><link rel="prefetch" href="/assets/js/330.4b69506d.js"><link rel="prefetch" href="/assets/js/331.f4e9123c.js"><link rel="prefetch" href="/assets/js/332.decc5f74.js"><link rel="prefetch" href="/assets/js/333.e729cfe0.js"><link rel="prefetch" href="/assets/js/334.a6d25832.js"><link rel="prefetch" href="/assets/js/335.863ce340.js"><link rel="prefetch" href="/assets/js/336.e1fdfcce.js"><link rel="prefetch" href="/assets/js/337.7ec69ad4.js"><link rel="prefetch" href="/assets/js/338.6279e3b4.js"><link rel="prefetch" href="/assets/js/339.9b23235d.js"><link rel="prefetch" href="/assets/js/34.19748377.js"><link rel="prefetch" href="/assets/js/340.7b6c78dc.js"><link rel="prefetch" href="/assets/js/341.1e4bac65.js"><link rel="prefetch" href="/assets/js/342.b79997de.js"><link rel="prefetch" href="/assets/js/343.db33f886.js"><link rel="prefetch" href="/assets/js/344.13b20d62.js"><link rel="prefetch" href="/assets/js/345.c334203e.js"><link rel="prefetch" href="/assets/js/346.536c03d6.js"><link rel="prefetch" href="/assets/js/347.2184fbfa.js"><link rel="prefetch" href="/assets/js/348.57ccabdc.js"><link rel="prefetch" href="/assets/js/349.99b549fc.js"><link rel="prefetch" href="/assets/js/35.80d3df6e.js"><link rel="prefetch" href="/assets/js/350.a46457f1.js"><link rel="prefetch" href="/assets/js/351.9da55b6a.js"><link rel="prefetch" href="/assets/js/352.f3798216.js"><link rel="prefetch" href="/assets/js/353.f7b95ddb.js"><link rel="prefetch" href="/assets/js/354.436f104a.js"><link rel="prefetch" href="/assets/js/355.8951e7a3.js"><link rel="prefetch" href="/assets/js/356.d2f3e4eb.js"><link rel="prefetch" href="/assets/js/357.c14203c7.js"><link rel="prefetch" href="/assets/js/358.299282e3.js"><link rel="prefetch" href="/assets/js/359.c9bed611.js"><link rel="prefetch" href="/assets/js/36.1013dc0b.js"><link rel="prefetch" href="/assets/js/360.ccfb13a8.js"><link rel="prefetch" href="/assets/js/361.05ec179c.js"><link rel="prefetch" href="/assets/js/362.427072fc.js"><link rel="prefetch" href="/assets/js/363.0ee122f9.js"><link rel="prefetch" href="/assets/js/364.0017ecc8.js"><link rel="prefetch" href="/assets/js/365.1230ac7c.js"><link rel="prefetch" href="/assets/js/366.f6914c2e.js"><link rel="prefetch" href="/assets/js/367.9fe0341d.js"><link rel="prefetch" href="/assets/js/368.a21bf199.js"><link rel="prefetch" href="/assets/js/369.39fe53ec.js"><link rel="prefetch" href="/assets/js/37.9a45ef0a.js"><link rel="prefetch" href="/assets/js/370.e701eeda.js"><link rel="prefetch" href="/assets/js/371.b90c9d30.js"><link rel="prefetch" href="/assets/js/372.a97bf0b2.js"><link rel="prefetch" href="/assets/js/373.4a798498.js"><link rel="prefetch" href="/assets/js/374.85ab3af8.js"><link rel="prefetch" href="/assets/js/375.43495a72.js"><link rel="prefetch" href="/assets/js/376.6b3cc970.js"><link rel="prefetch" href="/assets/js/377.03779254.js"><link rel="prefetch" href="/assets/js/378.34d40bb8.js"><link rel="prefetch" href="/assets/js/379.ca3a6942.js"><link rel="prefetch" href="/assets/js/38.d845e6b5.js"><link rel="prefetch" href="/assets/js/380.339b99c0.js"><link rel="prefetch" href="/assets/js/381.854ec26a.js"><link rel="prefetch" href="/assets/js/382.479978e6.js"><link rel="prefetch" href="/assets/js/383.01dc63bc.js"><link rel="prefetch" href="/assets/js/384.cb97ac09.js"><link rel="prefetch" href="/assets/js/385.f36cf5f6.js"><link rel="prefetch" href="/assets/js/386.7de0ab17.js"><link rel="prefetch" href="/assets/js/387.39f59b7c.js"><link rel="prefetch" href="/assets/js/388.95497a30.js"><link rel="prefetch" href="/assets/js/389.b448ed5e.js"><link rel="prefetch" href="/assets/js/39.77876eda.js"><link rel="prefetch" href="/assets/js/390.a66c4fc4.js"><link rel="prefetch" href="/assets/js/391.48062b7a.js"><link rel="prefetch" href="/assets/js/392.6e57278e.js"><link rel="prefetch" href="/assets/js/393.234e1194.js"><link rel="prefetch" href="/assets/js/394.b7d318c1.js"><link rel="prefetch" href="/assets/js/395.c164d904.js"><link rel="prefetch" href="/assets/js/396.1fc871e1.js"><link rel="prefetch" href="/assets/js/397.97aba7d4.js"><link rel="prefetch" href="/assets/js/398.f220283d.js"><link rel="prefetch" href="/assets/js/399.c59ca5b2.js"><link rel="prefetch" href="/assets/js/4.f1d08658.js"><link rel="prefetch" href="/assets/js/40.fb9333c4.js"><link rel="prefetch" href="/assets/js/400.da8d06aa.js"><link rel="prefetch" href="/assets/js/401.0d789e46.js"><link rel="prefetch" href="/assets/js/402.4de6e357.js"><link rel="prefetch" href="/assets/js/403.790f264a.js"><link rel="prefetch" href="/assets/js/404.82e81932.js"><link rel="prefetch" href="/assets/js/405.441ea069.js"><link rel="prefetch" href="/assets/js/406.bfadbb65.js"><link rel="prefetch" href="/assets/js/407.38f3a5ec.js"><link rel="prefetch" href="/assets/js/408.ecbffdd6.js"><link rel="prefetch" href="/assets/js/409.cd8ec16c.js"><link rel="prefetch" href="/assets/js/41.206dc183.js"><link rel="prefetch" href="/assets/js/410.3eae7a5b.js"><link rel="prefetch" href="/assets/js/411.4f3a7f1b.js"><link rel="prefetch" href="/assets/js/412.69bf0344.js"><link rel="prefetch" href="/assets/js/413.8c53eacf.js"><link rel="prefetch" href="/assets/js/414.d61f85f6.js"><link rel="prefetch" href="/assets/js/415.89165bcc.js"><link rel="prefetch" href="/assets/js/416.4e791dfd.js"><link rel="prefetch" href="/assets/js/417.45f0c4b2.js"><link rel="prefetch" href="/assets/js/418.48807d9c.js"><link rel="prefetch" href="/assets/js/419.4152ed23.js"><link rel="prefetch" href="/assets/js/42.15a1375e.js"><link rel="prefetch" href="/assets/js/420.96e4dc4d.js"><link rel="prefetch" href="/assets/js/421.f2aa7333.js"><link rel="prefetch" href="/assets/js/422.eb34edb8.js"><link rel="prefetch" href="/assets/js/423.c775b42f.js"><link rel="prefetch" href="/assets/js/424.585c7a0f.js"><link rel="prefetch" href="/assets/js/425.01403622.js"><link rel="prefetch" href="/assets/js/426.7755d4a2.js"><link rel="prefetch" href="/assets/js/427.9f553119.js"><link rel="prefetch" href="/assets/js/428.c8dd4f0c.js"><link rel="prefetch" href="/assets/js/429.3ed285c0.js"><link rel="prefetch" href="/assets/js/43.a03afca7.js"><link rel="prefetch" href="/assets/js/430.467c7eaa.js"><link rel="prefetch" href="/assets/js/431.3cbbe034.js"><link rel="prefetch" href="/assets/js/432.9c40e1ea.js"><link rel="prefetch" href="/assets/js/433.9add6475.js"><link rel="prefetch" href="/assets/js/434.b6cff804.js"><link rel="prefetch" href="/assets/js/435.b1fd54d5.js"><link rel="prefetch" href="/assets/js/436.dcb99738.js"><link rel="prefetch" href="/assets/js/437.9562e869.js"><link rel="prefetch" href="/assets/js/438.1b87f7a1.js"><link rel="prefetch" href="/assets/js/439.51a7f392.js"><link rel="prefetch" href="/assets/js/44.08819acf.js"><link rel="prefetch" href="/assets/js/440.ba244e0b.js"><link rel="prefetch" href="/assets/js/441.6247c292.js"><link rel="prefetch" href="/assets/js/442.317331fe.js"><link rel="prefetch" href="/assets/js/443.66412722.js"><link rel="prefetch" href="/assets/js/444.f12bd7bb.js"><link rel="prefetch" href="/assets/js/445.8dd4cba1.js"><link rel="prefetch" href="/assets/js/446.dc2f7fe1.js"><link rel="prefetch" href="/assets/js/447.4024dc6d.js"><link rel="prefetch" href="/assets/js/448.9f473a57.js"><link rel="prefetch" href="/assets/js/449.2fde71a1.js"><link rel="prefetch" href="/assets/js/45.dbfa99cc.js"><link rel="prefetch" href="/assets/js/450.caa7dbd8.js"><link rel="prefetch" href="/assets/js/451.0509ac4e.js"><link rel="prefetch" href="/assets/js/452.f4535c29.js"><link rel="prefetch" href="/assets/js/453.8feab1b9.js"><link rel="prefetch" href="/assets/js/454.b85825f2.js"><link rel="prefetch" href="/assets/js/455.8398d19c.js"><link rel="prefetch" href="/assets/js/456.b50f3dd0.js"><link rel="prefetch" href="/assets/js/457.ada86b83.js"><link rel="prefetch" href="/assets/js/458.7f24755f.js"><link rel="prefetch" href="/assets/js/459.a5e5c3eb.js"><link rel="prefetch" href="/assets/js/46.8cad9b71.js"><link rel="prefetch" href="/assets/js/460.b42f4a81.js"><link rel="prefetch" href="/assets/js/461.67f0b35b.js"><link rel="prefetch" href="/assets/js/462.1ab358db.js"><link rel="prefetch" href="/assets/js/463.0ac7350c.js"><link rel="prefetch" href="/assets/js/464.45c469a9.js"><link rel="prefetch" href="/assets/js/465.cdd85a89.js"><link rel="prefetch" href="/assets/js/466.81d406f8.js"><link rel="prefetch" href="/assets/js/467.d566f183.js"><link rel="prefetch" href="/assets/js/468.50345fae.js"><link rel="prefetch" href="/assets/js/469.1c7dbd36.js"><link rel="prefetch" href="/assets/js/47.b613df2f.js"><link rel="prefetch" href="/assets/js/470.5cfc2898.js"><link rel="prefetch" href="/assets/js/48.7dd353ac.js"><link rel="prefetch" href="/assets/js/49.c6acb8a5.js"><link rel="prefetch" href="/assets/js/50.f98e787a.js"><link rel="prefetch" href="/assets/js/51.fca7ece9.js"><link rel="prefetch" href="/assets/js/52.dfd2418a.js"><link rel="prefetch" href="/assets/js/53.0547a2da.js"><link rel="prefetch" href="/assets/js/54.77c456cb.js"><link rel="prefetch" href="/assets/js/55.2ea7947c.js"><link rel="prefetch" href="/assets/js/56.93aa6440.js"><link rel="prefetch" href="/assets/js/57.e1c7aaa6.js"><link rel="prefetch" href="/assets/js/58.5368de52.js"><link rel="prefetch" href="/assets/js/59.fb2e12ff.js"><link rel="prefetch" href="/assets/js/6.fe5e508e.js"><link rel="prefetch" href="/assets/js/60.b8e6a986.js"><link rel="prefetch" href="/assets/js/61.fe69b359.js"><link rel="prefetch" href="/assets/js/62.74e87082.js"><link rel="prefetch" href="/assets/js/63.75ce37b4.js"><link rel="prefetch" href="/assets/js/64.3b4f72ef.js"><link rel="prefetch" href="/assets/js/65.3f53a9a4.js"><link rel="prefetch" href="/assets/js/66.8403887b.js"><link rel="prefetch" href="/assets/js/67.a2a1488d.js"><link rel="prefetch" href="/assets/js/68.f1c01bf8.js"><link rel="prefetch" href="/assets/js/69.ef3591d4.js"><link rel="prefetch" href="/assets/js/7.a65affc1.js"><link rel="prefetch" href="/assets/js/70.df41328b.js"><link rel="prefetch" href="/assets/js/71.d8cd75fb.js"><link rel="prefetch" href="/assets/js/72.e781e7e1.js"><link rel="prefetch" href="/assets/js/73.aaf45776.js"><link rel="prefetch" href="/assets/js/74.2a35588a.js"><link rel="prefetch" href="/assets/js/75.e8adcf85.js"><link rel="prefetch" href="/assets/js/76.16da36dd.js"><link rel="prefetch" href="/assets/js/77.201f553d.js"><link rel="prefetch" href="/assets/js/78.bb374675.js"><link rel="prefetch" href="/assets/js/79.7b92c1ff.js"><link rel="prefetch" href="/assets/js/8.08fdf9a5.js"><link rel="prefetch" href="/assets/js/80.273f2594.js"><link rel="prefetch" href="/assets/js/81.4fbbe071.js"><link rel="prefetch" href="/assets/js/82.4d39e160.js"><link rel="prefetch" href="/assets/js/83.24e0a19d.js"><link rel="prefetch" href="/assets/js/84.0c030198.js"><link rel="prefetch" href="/assets/js/85.00fc1248.js"><link rel="prefetch" href="/assets/js/86.7bd1bf53.js"><link rel="prefetch" href="/assets/js/87.5b28d027.js"><link rel="prefetch" href="/assets/js/88.8c5037f4.js"><link rel="prefetch" href="/assets/js/89.a06dc5bd.js"><link rel="prefetch" href="/assets/js/90.2df5d8ba.js"><link rel="prefetch" href="/assets/js/91.c3326db3.js"><link rel="prefetch" href="/assets/js/92.57931d85.js"><link rel="prefetch" href="/assets/js/93.bcda9957.js"><link rel="prefetch" href="/assets/js/94.43d71792.js"><link rel="prefetch" href="/assets/js/95.65bbe7b0.js"><link rel="prefetch" href="/assets/js/96.4d8b933c.js"><link rel="prefetch" href="/assets/js/97.9ef35d1d.js"><link rel="prefetch" href="/assets/js/98.94a4172c.js"><link rel="prefetch" href="/assets/js/99.9db6ba1a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6aa5acdd.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/index/book.png" alt="Haoyuan's blog" class="logo"> <span class="site-name can-hide">Haoyuan's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/navigation/" class="nav-link">导航站</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/se/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/java/collection/" class="nav-link">Java集合</a></li><li class="dropdown-subitem"><a href="/java/se/reflect/" class="nav-link">Java反射</a></li><li class="dropdown-subitem"><a href="/java/juc/" class="nav-link">JavaJUC</a></li><li class="dropdown-subitem"><a href="/java/jvm/" class="nav-link">JavaJVM</a></li></ul></li><li class="dropdown-item"><h4>Java容器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/javaweb/concept/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Java版本新特性</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/new-features/" class="nav-link">Java新特性</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/oracle/" class="nav-link">Oracle</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/es/" class="nav-link">ElasticSearch</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/frames/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mybatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/mybatis-plus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>消息中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/activemq/" class="nav-link">ActiveMQ</a></li><li class="dropdown-subitem"><a href="/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/rocketmq/" class="nav-link">RocketMQ</a></li><li class="dropdown-subitem"><a href="/kafka/" class="nav-link">Kafka</a></li></ul></li><li class="dropdown-item"><h4>进阶服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nginx/" class="nav-link">Nginx</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring生态" class="dropdown-title"><a href="/spring-ecology/" class="link-title">Spring生态</a> <span class="title" style="display:none;">Spring生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/spring-boot/" class="nav-link">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/spring-security/" class="nav-link">Spring Security</a></li><li class="dropdown-item"><!----> <a href="/spring-cloud/" class="nav-link">Spring Cloud</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/dev-guide/" class="link-title">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design-pattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/knowledge/" class="nav-link">知识</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tool/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/maven/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/git/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/docker/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/jenkins/" class="nav-link">Jenkins</a></li><li class="dropdown-subitem"><a href="/kubernetes/" class="nav-link">Kubernetes</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/typescript/" class="nav-link">TypeScript</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/vue2/" class="nav-link">Vue2</a></li><li class="dropdown-subitem"><a href="/vue3/" class="nav-link">Vue3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whells-use/" class="nav-link">轮子工具</a></li><li class="dropdown-item"><!----> <a href="/projects/" class="nav-link">项目工程</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whell/web/" class="nav-link">收藏</a></li><li class="dropdown-subitem"><a href="/about/mdskill/" class="nav-link">关于</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/message-area/" class="nav-link">留言区</a></div> <a href="https://github.com/Somnus711/Somnus711.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/Somnus711/picx-image-hosting@master/blog-pic/avatar.2b7e13idyy9s.webp"> <div class="blogger-info"><h3>Somnus Haoyuan</h3> <span>Word is cheap, show me the code.</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/navigation/" class="nav-link">导航站</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/se/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/java/collection/" class="nav-link">Java集合</a></li><li class="dropdown-subitem"><a href="/java/se/reflect/" class="nav-link">Java反射</a></li><li class="dropdown-subitem"><a href="/java/juc/" class="nav-link">JavaJUC</a></li><li class="dropdown-subitem"><a href="/java/jvm/" class="nav-link">JavaJVM</a></li></ul></li><li class="dropdown-item"><h4>Java容器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/javaweb/concept/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Java版本新特性</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/new-features/" class="nav-link">Java新特性</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/oracle/" class="nav-link">Oracle</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/es/" class="nav-link">ElasticSearch</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/frames/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mybatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/mybatis-plus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>消息中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/activemq/" class="nav-link">ActiveMQ</a></li><li class="dropdown-subitem"><a href="/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/rocketmq/" class="nav-link">RocketMQ</a></li><li class="dropdown-subitem"><a href="/kafka/" class="nav-link">Kafka</a></li></ul></li><li class="dropdown-item"><h4>进阶服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nginx/" class="nav-link">Nginx</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring生态" class="dropdown-title"><a href="/spring-ecology/" class="link-title">Spring生态</a> <span class="title" style="display:none;">Spring生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/spring-boot/" class="nav-link">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/spring-security/" class="nav-link">Spring Security</a></li><li class="dropdown-item"><!----> <a href="/spring-cloud/" class="nav-link">Spring Cloud</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/dev-guide/" class="link-title">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design-pattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/knowledge/" class="nav-link">知识</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tool/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/maven/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/git/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/docker/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/jenkins/" class="nav-link">Jenkins</a></li><li class="dropdown-subitem"><a href="/kubernetes/" class="nav-link">Kubernetes</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/typescript/" class="nav-link">TypeScript</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/vue2/" class="nav-link">Vue2</a></li><li class="dropdown-subitem"><a href="/vue3/" class="nav-link">Vue3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whells-use/" class="nav-link">轮子工具</a></li><li class="dropdown-item"><!----> <a href="/projects/" class="nav-link">项目工程</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whell/web/" class="nav-link">收藏</a></li><li class="dropdown-subitem"><a href="/about/mdskill/" class="nav-link">关于</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/message-area/" class="nav-link">留言区</a></div> <a href="https://github.com/Somnus711/Somnus711.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis-Plus</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件 - ActiveMQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件 - RabbitMQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件 - RocketMQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件 - Kafka</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>高性能服务器 - Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>响应式框架 - Reactor</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reactor/quick-start/" class="sidebar-link">Reactor - 快速上手</a></li><li><a href="/reactor/reactive-programming/" class="sidebar-link">Reactor - 响应式编程</a></li><li><a href="/reactor/core-features/" class="sidebar-link">Reactor - 核心特征</a></li><li><a href="/reactor/kotlin-support/" class="sidebar-link">Reactor - 对 Kotlin 的支持</a></li><li><a href="/reactor/unit-test/" class="sidebar-link">Reactor - 单元测试</a></li><li><a href="/reactor/debug/" class="sidebar-link">Reactor - 调试 Reactor</a></li><li><a href="/reactor/advanced-features-and-concepts/" aria-current="page" class="active sidebar-link">Reactor - 高级特性与概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/reactor/advanced-features-and-concepts/#打包重用操作符" class="sidebar-link">打包重用操作符</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#使用-transform-操作符" class="sidebar-link">使用 transform 操作符</a></li><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#使用-compose-操作符" class="sidebar-link">使用 compose 操作符</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/reactor/advanced-features-and-concepts/#hot-vs-cold" class="sidebar-link">Hot vs Cold</a></li><li class="sidebar-sub-header level2"><a href="/reactor/advanced-features-and-concepts/#使用-connectableflux-对多个订阅者进行广播" class="sidebar-link">使用 ConnectableFlux 对多个订阅者进行广播</a></li><li class="sidebar-sub-header level2"><a href="/reactor/advanced-features-and-concepts/#三种分批处理方式" class="sidebar-link">三种分批处理方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#进行分组" class="sidebar-link">进行分组</a></li><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#进行-window-操作" class="sidebar-link">进行 window 操作</a></li><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#进行缓存" class="sidebar-link">进行缓存</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/reactor/advanced-features-and-concepts/#使用-parallelflux-进行并行处理" class="sidebar-link">使用 ParallelFlux 进行并行处理</a></li><li class="sidebar-sub-header level2"><a href="/reactor/advanced-features-and-concepts/#替换默认的-schedulers" class="sidebar-link">替换默认的 Schedulers</a></li><li class="sidebar-sub-header level2"><a href="/reactor/advanced-features-and-concepts/#使用全局的-hooks" class="sidebar-link">使用全局的 Hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#丢弃事件的-hooks" class="sidebar-link">丢弃事件的 Hooks</a></li><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#内部错误-hook" class="sidebar-link">内部错误 Hook</a></li><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#组装-hooks" class="sidebar-link">组装 Hooks</a></li><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#预置-hooks" class="sidebar-link">预置 Hooks</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/reactor/advanced-features-and-concepts/#增加一个-context-到响应式序列" class="sidebar-link">增加一个 Context 到响应式序列</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#context-api" class="sidebar-link">Context API</a></li><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#把-context-绑定到-flux-and-writing" class="sidebar-link">把 Context 绑定到 Flux and Writing</a></li><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#读取-context" class="sidebar-link">读取 Context</a></li><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#简单的例子" class="sidebar-link">简单的例子</a></li><li class="sidebar-sub-header level3"><a href="/reactor/advanced-features-and-concepts/#完整的例子" class="sidebar-link">完整的例子</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/reactor/advanced-features-and-concepts/#空值安全" class="sidebar-link">空值安全</a></li></ul></li><li><a href="/reactor/operators-summary/" class="sidebar-link">Reactor - 操作符总结</a></li><li><a href="/reactor/best-practices/" class="sidebar-link">Reactor - 最佳实践</a></li><li><a href="/reactor/extensibility/" class="sidebar-link">Reactor - 扩展性</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E6%A1%86%E6%9E%B6" title="分类" data-v-06225672>框架</a></li><li data-v-06225672><a href="/categories/?category=%E5%93%8D%E5%BA%94%E5%BC%8F%E6%A1%86%E6%9E%B6%20-%20Reactor" title="分类" data-v-06225672>响应式框架 - Reactor</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://www.denghaoyuan.com/" target="_blank" title="作者" class="beLink" data-v-06225672>Haoyuan</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-11-02</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Reactor - 高级特性与概念<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#打包重用操作符">打包重用操作符</a><ul><li><a href="#使用-transform-操作符">使用 transform 操作符</a></li><li><a href="#使用-compose-操作符">使用 compose 操作符</a></li></ul></li><li><a href="#hot-vs-cold">Hot vs Cold</a></li><li><a href="#使用-connectableflux-对多个订阅者进行广播">使用 ConnectableFlux 对多个订阅者进行广播</a></li><li><a href="#三种分批处理方式">三种分批处理方式</a><ul><li><a href="#进行分组">进行分组</a></li><li><a href="#进行-window-操作">进行 window 操作</a></li><li><a href="#进行缓存">进行缓存</a></li></ul></li><li><a href="#使用-parallelflux-进行并行处理">使用 ParallelFlux 进行并行处理</a></li><li><a href="#替换默认的-schedulers">替换默认的 Schedulers</a></li><li><a href="#使用全局的-hooks">使用全局的 Hooks</a><ul><li><a href="#丢弃事件的-hooks">丢弃事件的 Hooks</a></li><li><a href="#内部错误-hook">内部错误 Hook</a></li><li><a href="#组装-hooks">组装 Hooks</a></li><li><a href="#预置-hooks">预置 Hooks</a></li></ul></li><li><a href="#增加一个-context-到响应式序列">增加一个 Context 到响应式序列</a><ul><li><a href="#context-api">Context API</a></li><li><a href="#把-context-绑定到-flux-and-writing">把 Context 绑定到 Flux and Writing</a></li><li><a href="#读取-context">读取 Context</a></li><li><a href="#简单的例子">简单的例子</a></li><li><a href="#完整的例子">完整的例子</a></li></ul></li><li><a href="#空值安全">空值安全</a></li></ul></div><p></p> <h2 id="打包重用操作符"><a href="#打包重用操作符" class="header-anchor">#</a> 打包重用操作符</h2> <p>从代码整洁的角度来说，重用代码是一个好办法。Reactor 提供了几种帮你打包重用代码的方式， 主要通过使用操作符或者常用的「操作符组合」的方法来实现。如果你觉得一段操作链很常用， 你可以将这段操作链打包封装后备用。</p> <h3 id="使用-transform-操作符"><a href="#使用-transform-操作符" class="header-anchor">#</a> 使用 <code>transform</code> 操作符</h3> <p><code>transform</code> 操作符可以将一段操作链封装为一个函数式（function）。这个函数式能在操作期（assembly time） 将被封装的操作链中的操作符还原并接入到调用 <code>transform</code> 的位置。这样做和直接将被封装的操作符 加入到链上的效果是一样的。示例如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Flux</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Flux</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> filterAndMap <span class="token operator">=</span>
f <span class="token operator">-&gt;</span> f<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>color <span class="token operator">-&gt;</span> <span class="token operator">!</span>color<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;orange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">fromIterable</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;purple&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">doOnNext</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>filterAndMap<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>d <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Subscriber to Transformed MapAndFilter: &quot;</span><span class="token operator">+</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/MapStructPlus/20241102152303.png" alt="image-20241102152302021"></p> <p>上边例子的输出如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>blue
<span class="token class-name">Subscriber</span> <span class="token keyword">to</span> <span class="token class-name">Transformed</span> <span class="token class-name">MapAndFilter</span><span class="token operator">:</span> <span class="token constant">BLUE</span>
green
<span class="token class-name">Subscriber</span> <span class="token keyword">to</span> <span class="token class-name">Transformed</span> <span class="token class-name">MapAndFilter</span><span class="token operator">:</span> <span class="token constant">GREEN</span>
orange
purple
<span class="token class-name">Subscriber</span> <span class="token keyword">to</span> <span class="token class-name">Transformed</span> <span class="token class-name">MapAndFilter</span><span class="token operator">:</span> <span class="token constant">PURPLE</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="使用-compose-操作符"><a href="#使用-compose-操作符" class="header-anchor">#</a> 使用 <code>compose</code> 操作符</h3> <p><code>compose</code> 操作符与 <code>transform</code> 类似，也能够将几个操作符封装到一个函数式中。 主要的区别就是，这个函数式作用到原始序列上的话，是 <strong>基于每一个订阅者的（on a per-subscriber basis）</strong> 。这意味着它对每一个 subscription 可以生成不同的操作链（通过维护一些状态值）。 如下例所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">AtomicInteger</span> ai <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Flux</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Flux</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> filterAndMap <span class="token operator">=</span> f <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ai<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> f<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>color <span class="token operator">-&gt;</span> <span class="token operator">!</span>color<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;orange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> f<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>color <span class="token operator">-&gt;</span> <span class="token operator">!</span>color<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;purple&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> composedFlux <span class="token operator">=</span>
<span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">fromIterable</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;purple&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">doOnNext</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>filterAndMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

composedFlux<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>d <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Subscriber 1 to Composed MapAndFilter :&quot;</span><span class="token operator">+</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
composedFlux<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>d <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Subscriber 2 to Composed MapAndFilter: &quot;</span><span class="token operator">+</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/MapStructPlus/20241102152337.png" alt="image-20241102152336466"></p> <p>上边的例子输出如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>blue
<span class="token class-name">Subscriber</span> <span class="token number">1</span> <span class="token keyword">to</span> <span class="token class-name">Composed</span> <span class="token class-name">MapAndFilter</span> <span class="token operator">:</span><span class="token constant">BLUE</span>
green
<span class="token class-name">Subscriber</span> <span class="token number">1</span> <span class="token keyword">to</span> <span class="token class-name">Composed</span> <span class="token class-name">MapAndFilter</span> <span class="token operator">:</span><span class="token constant">GREEN</span>
orange
purple
<span class="token class-name">Subscriber</span> <span class="token number">1</span> <span class="token keyword">to</span> <span class="token class-name">Composed</span> <span class="token class-name">MapAndFilter</span> <span class="token operator">:</span><span class="token constant">PURPLE</span>
blue
<span class="token class-name">Subscriber</span> <span class="token number">2</span> <span class="token keyword">to</span> <span class="token class-name">Composed</span> <span class="token class-name">MapAndFilter</span><span class="token operator">:</span> <span class="token constant">BLUE</span>
green
<span class="token class-name">Subscriber</span> <span class="token number">2</span> <span class="token keyword">to</span> <span class="token class-name">Composed</span> <span class="token class-name">MapAndFilter</span><span class="token operator">:</span> <span class="token constant">GREEN</span>
orange
<span class="token class-name">Subscriber</span> <span class="token number">2</span> <span class="token keyword">to</span> <span class="token class-name">Composed</span> <span class="token class-name">MapAndFilter</span><span class="token operator">:</span> <span class="token constant">ORANGE</span>
purple
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="hot-vs-cold"><a href="#hot-vs-cold" class="header-anchor">#</a> Hot vs Cold</h2> <p>到目前为止，我们一直认为 <code>Flux</code>（和 <code>Mono</code>）都是这样的：它们都代表了一种异步的数据序列， 在订阅（subscribe）之前什么都不会发生。</p> <p>但是实际上，广义上有两种发布者：「热」与「冷」（<strong>hot</strong> and <strong>cold</strong>）。</p> <p>（本文档）到目前介绍的其实都是 <strong>cold</strong> 家族的发布者。它们为每一个订阅（subscription） 都生成数据。如果没有创建任何订阅（subscription），那么就不会生成数据。</p> <p>试想一个 HTTP 请求：每一个新的订阅者都会触发一个 HTTP 调用，但是如果没有订阅者关心结果的话， 那就不会有任何调用。</p> <p>另一方面，<strong>热</strong> 发布者，不依赖于订阅者的数量。即使没有订阅者它们也会发出数据， 如果有一个订阅者接入进来，那么它就会收到订阅之后发出的元素。对于热发布者， 在你订阅它之前，确实已经发生了什么。</p> <p><code>just</code> 是 Reactor 中少数几个「热」操作符的例子之一：它直接在组装期（assembly time） 就拿到数据，如果之后有谁订阅它，就重新发送数据给订阅者。再拿 HTTP 调用举例，如果给 <code>just</code> 传入的数据是一个 HTTP 调用的结果，那么之后在初始化 <em>just</em> 的时候才会进行唯一的一次网络调用。</p> <p>如果想将 <code>just</code> 转化为一种 <em>冷</em> 的发布者，你可以使用 <code>defer</code>。它能够将刚才例子中对 HTTP 的请求延迟到订阅时（这样的话，对于每一个新的订阅来说，都会发生一次网络调用）。</p> <blockquote><p>Reactor 中多数其他的 <em>热</em> 发布者是扩展自 <code>Processor</code> 的。</p></blockquote> <p>考虑其他两个例子，如下是第一个例子：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> source <span class="token operator">=</span> <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">fromIterable</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;purple&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">doOnNext</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;o&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>d <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Subscriber 1: &quot;</span><span class="token operator">+</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>d <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Subscriber 2: &quot;</span><span class="token operator">+</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>第一个例子输出如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>blue
green
orange
<span class="token class-name">Subscriber</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token constant">ORANGE</span>
purple
blue
green
orange
<span class="token class-name">Subscriber</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token constant">ORANGE</span>
purple
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/MapStructPlus/20241102152357.png" alt="image-20241102152356014"></p> <p>两个订阅者都触发了所有的颜色，因为每一个订阅者都会让构造 <code>Flux</code> 的操作符运行一次。</p> <p>将下边的例子与第一个例子对比：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">UnicastProcessor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> hotSource <span class="token operator">=</span> <span class="token class-name">UnicastProcessor</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> hotFlux <span class="token operator">=</span> hotSource<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">autoConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


hotFlux<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>d <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Subscriber 1 to Hot Source: &quot;</span><span class="token operator">+</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

hotSource<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hotSource<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token string">&quot;green&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

hotFlux<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>d <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Subscriber 2 to Hot Source: &quot;</span><span class="token operator">+</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

hotSource<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token string">&quot;orange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hotSource<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token string">&quot;purple&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hotSource<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>第二个例子输出如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Subscriber</span> <span class="token number">1</span> <span class="token keyword">to</span> <span class="token class-name">Hot</span> <span class="token class-name">Source</span><span class="token operator">:</span> <span class="token constant">BLUE</span>
<span class="token class-name">Subscriber</span> <span class="token number">1</span> <span class="token keyword">to</span> <span class="token class-name">Hot</span> <span class="token class-name">Source</span><span class="token operator">:</span> <span class="token constant">GREEN</span>
<span class="token class-name">Subscriber</span> <span class="token number">1</span> <span class="token keyword">to</span> <span class="token class-name">Hot</span> <span class="token class-name">Source</span><span class="token operator">:</span> <span class="token constant">ORANGE</span>
<span class="token class-name">Subscriber</span> <span class="token number">2</span> <span class="token keyword">to</span> <span class="token class-name">Hot</span> <span class="token class-name">Source</span><span class="token operator">:</span> <span class="token constant">ORANGE</span>
<span class="token class-name">Subscriber</span> <span class="token number">1</span> <span class="token keyword">to</span> <span class="token class-name">Hot</span> <span class="token class-name">Source</span><span class="token operator">:</span> <span class="token constant">PURPLE</span>
<span class="token class-name">Subscriber</span> <span class="token number">2</span> <span class="token keyword">to</span> <span class="token class-name">Hot</span> <span class="token class-name">Source</span><span class="token operator">:</span> <span class="token constant">PURPLE</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/MapStructPlus/20241102152412.png" alt="image-20241102152411194"></p> <p>第一个订阅者收到了所有的四个颜色，第二个订阅者由于是在前两个颜色发出之后订阅的， 故而收到了之后的两个颜色，在输出中有两次 &quot;ORANGE&quot; 和 &quot;PURPLE&quot;。从这个例子可见， 无论是否有订阅者接入进来，这个 Flux 都会运行。</p> <h2 id="使用-connectableflux-对多个订阅者进行广播"><a href="#使用-connectableflux-对多个订阅者进行广播" class="header-anchor">#</a> 使用 <code>ConnectableFlux</code> 对多个订阅者进行广播</h2> <p>有时候，你不仅想要延迟到某一个订阅者订阅之后才开始发出数据，可能还希望在多个订阅者 <em>到齐</em> <strong>之后</strong> 才开始。</p> <p><code>ConnectableFlux</code> 的用意便在于此。<code>Flux</code> API 中有两种主要的返回 <code>ConnectableFlux</code> 的方式：<code>publish</code> 和 <code>replay</code>。</p> <ul><li><code>publish</code> 会尝试满足各个不同订阅者的需求（背压），并综合这些请求反馈给源。 尤其是如果有某个订阅者的需求为 <code>0</code>，publish 会 <strong>暂停</strong> 它对源的请求。</li> <li><code>replay</code> 将对第一个订阅后产生的数据进行缓存，最多缓存数量取决于配置（时间/缓存大小）。 它会对后续接入的订阅者重新发送数据。</li></ul> <p><code>ConnectableFlux</code> 提供了多种对下游订阅的管理。包括：</p> <ul><li><code>connect</code> 当有足够的订阅接入后，可以对 flux 手动执行一次。它会触发对上游源的订阅。</li> <li><code>autoConnect(n)</code> 与 connect 类似，不过是在有 <code>n</code> 个订阅的时候自动触发。</li> <li><code>refCount(n)</code> 不仅能够在订阅者接入的时候自动触发，还会检测订阅者的取消动作。如果订阅者数量不够， 会将源「断开连接」，再有新的订阅者接入的时候才会继续「连上」源。</li> <li><code>refCount(int, Duration)</code> 增加了一个 &quot;优雅的倒计时&quot;：一旦订阅者数量太低了，它会等待 <code>Duration</code> 的时间，如果没有新的订阅者接入才会与源「断开连接」。</li></ul> <p>示例如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> source <span class="token operator">=</span> <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
                           <span class="token punctuation">.</span><span class="token function">doOnSubscribe</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;subscribed to source&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ConnectableFlux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> co <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

co<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">,</span> e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
co<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">,</span> e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;done subscribing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;will now connect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

co<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>The preceding code produces the following output:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>done subscribing
will now connect
subscribed <span class="token keyword">to</span> <span class="token namespace">source</span>
<span class="token number">1</span>
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>使用 <code>autoConnect</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> source <span class="token operator">=</span> <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
                           <span class="token punctuation">.</span><span class="token function">doOnSubscribe</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;subscribed to source&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> autoCo <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">autoConnect</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

autoCo<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">,</span> e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;subscribed first&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;subscribing second&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
autoCo<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">,</span> e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>以上代码输出如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>subscribed first
subscribing second
subscribed <span class="token keyword">to</span> <span class="token namespace">source</span>
<span class="token number">1</span>
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="三种分批处理方式"><a href="#三种分批处理方式" class="header-anchor">#</a> 三种分批处理方式</h2> <p>当你有许多的元素，并且想将他们分批处理，Reactor 总体上有三种方案：分组（grouping）、 窗口（windowing）、缓存（buffering）。 这三种在概念上类似，因为它们都是将 <code>Flux&lt;T&gt;</code> 进行聚集。分组和分段操作都会创建一个 <code>Flux&lt;Flux&lt;T&gt;&gt;</code>，而缓存操作得到的是一个 <code>Collection&lt;T&gt;</code>（应该是一个 <code>Flux&lt;Collection&lt;T&gt;&gt;</code>)。</p> <h3 id="进行分组"><a href="#进行分组" class="header-anchor">#</a> 进行分组</h3> <p>用 <code>Flux&lt;GroupedFlux&lt;T&gt;&gt;</code> 进行分组。</p> <p>分组能够根据 <strong>key</strong> 将源 <code>Flux&lt;T&gt;</code> 拆分为多个批次。</p> <p>对应的操作符是 <code>groupBy</code>。</p> <p>每一组用 <code>GroupedFlux&lt;T&gt;</code> 类型表示，使用它的 <code>key()</code> 方法可以得到该组的 key。</p> <p>在组内，元素并不需要是连续的。当源发出一个新的元素，该元素会被分发到与之匹配的 key 所对应的组中（如果还没有该 key 对应的组，则创建一个）。</p> <p>这意味着组：</p> <ol><li>是互相没有交集的（一个元素只属于一个组）</li> <li>会包含原始序列中任意位置的元素</li> <li>不会为空</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
        <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">&quot;even&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;odd&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">concatMap</span><span class="token punctuation">(</span>g <span class="token operator">-&gt;</span> g<span class="token punctuation">.</span><span class="token function">defaultIfEmpty</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 如果组为空，显示为 -1</span>
                                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">valueOf</span><span class="token punctuation">)</span> <span class="token comment">// 转换为字符串</span>
                                <span class="token punctuation">.</span><span class="token function">startWith</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 以该组的 key 开头</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token string">&quot;odd&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;11&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;13&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token string">&quot;even&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;6&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;12&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>分组操作适用于分组个数不多的场景。而且所有的组都必须被消费，这样 <code>groupBy</code> 才能持续从上游获取数据。有时候这两种要求在一起——比如元素数量超多， 但是并行的用来消费的 <code>flatMap</code> 又太少的时候——会导致程序卡死。</p></blockquote> <h3 id="进行-window-操作"><a href="#进行-window-操作" class="header-anchor">#</a> 进行 window 操作</h3> <p>使用 <code>Flux&lt;Flux&lt;T&gt;&gt;</code> 进行 window 操作。</p> <p>window 操作是 根据个数、时间等条件，或能够定义边界的发布者（boundary-defining <code>Publisher</code>）， 把源 <code>Flux&lt;T&gt;</code> 拆分为 <em>windows</em>。</p> <p>对应的操作符有 <code>window</code>、<code>windowTimeout</code>、<code>windowUntil</code>、<code>windowWhile</code>，以及 <code>windowWhen</code>。</p> <p>与 <code>groupBy</code> 的主要区别在于，窗口操作能够保持序列顺序。并且同一时刻最多只能有两个 window 是开启的。</p> <p>它们 <strong>可以</strong> 重叠。操作符参数有 <code>maxSize</code> 和 <code>skip</code>，<code>maxSize</code> 指定收集多少个元素就关闭 window，而 <code>skip</code> 指定收集多数个元素后就打开下一个 window。所以如果 <code>maxSize &gt; skip</code> 的话， 一个新的 window 的开启会先于当前 window 的关闭， 从而二者会有重叠。</p> <p>重叠的 window 示例如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
        <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">//overlapping windows</span>
                <span class="token punctuation">.</span><span class="token function">concatMap</span><span class="token punctuation">(</span>g <span class="token operator">-&gt;</span> g<span class="token punctuation">.</span><span class="token function">defaultIfEmpty</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//将 windows 显示为 -1</span>
        <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>如果将两个参数的配置反过来（<code>maxSize</code> &lt; <code>skip</code>），序列中的一些元素就会被丢弃掉， 而不属于任何 window。</p></blockquote> <p>对基于判断条件的 <code>windowUntil</code> 和 <code>windowWhile</code>，如果序列中的元素不匹配判断条件， 那么可能导致 <em>空 windows</em>，如下例所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
        <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">windowWhile</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">concatMap</span><span class="token punctuation">(</span>g <span class="token operator">-&gt;</span> g<span class="token punctuation">.</span><span class="token function">defaultIfEmpty</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//分别被奇数 1 3 5 触发</span>
                <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token comment">// 被 11 触发</span>
                <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token comment">// 被 13 触发</span>
                <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 空的 completion window，如果 onComplete 前的元素能够匹配上的话就没有这个了</span>
                <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="进行缓存"><a href="#进行缓存" class="header-anchor">#</a> 进行缓存</h3> <p>使用 <code>Flux&lt;List&lt;T&gt;&gt;</code> 进行缓存。</p> <p>缓存与窗口类似，不同在于：缓存操作之后会发出 <em>buffers</em> （类型为<code>Collection&lt;T&gt;</code>， 默认是 <code>List&lt;T&gt;</code>)，而不是 <em>windows</em> （类型为 <code>Flux&lt;T&gt;</code>）。</p> <p>缓存的操作符与窗口的操作符是对应的：<code>buffer</code>、<code>bufferTimeout</code>、<code>bufferUntil</code>、<code>bufferWhile</code>， 以及<code>bufferWhen</code>。</p> <p>如果说对于窗口操作符来说，是开启一个窗口，那么对于缓存操作符来说，就是创建一个新的集合， 然后对其添加元素。而窗口操作符在关闭窗口的时候，缓存操作符则是发出一个集合。</p> <p>缓存操作也会有丢弃元素或内容重叠的情况，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
        <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 缓存重叠</span>
        <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>不像窗口方法，<code>bufferUntil</code> 和 <code>bufferWhile</code> 不会发出空的 buffer，如下例所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
        <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bufferWhile</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 被 11 触发</span>
        <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 被 13 触发</span>
        <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="使用-parallelflux-进行并行处理"><a href="#使用-parallelflux-进行并行处理" class="header-anchor">#</a> 使用 <code>ParallelFlux</code> 进行并行处理</h2> <p>如今多核架构已然普及，能够方便的进行并行处理是很重要的。Reactor 提供了一种特殊的类型 <code>ParallelFlux</code> 来实现并行，它能够将操作符调整为并行处理方式。</p> <p>你可以对任何 <code>Flux</code> 使用 <code>parallel()</code> 操作符来得到一个 <code>ParallelFlux</code>. <strong>不过这个操作符本身并不会进行并行处理</strong>，而是将负载划分到多个「轨道（rails）」上 （默认情况下，轨道个数与 CPU 核数相等）。</p> <p>为了配置 ParallelFlux 如何并行地执行每一个轨道，你需要使用 <code>runOn(Scheduler)</code>。 注意，<code>Schedulers.parallel()</code> 是推荐的专门用于并行处理的调度器。</p> <p>下边有两个用于比较的例子，第一个如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
    <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; -&gt; &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol><li>我们给定一个轨道数字，而不是依赖于 CPU 核数</li></ol> <p>下边是第二个例子：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">runOn</span><span class="token punctuation">(</span><span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; -&gt; &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>第一个例子输出如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>main <span class="token operator">-&gt;</span> <span class="token number">1</span>
main <span class="token operator">-&gt;</span> <span class="token number">2</span>
main <span class="token operator">-&gt;</span> <span class="token number">3</span>
main <span class="token operator">-&gt;</span> <span class="token number">4</span>
main <span class="token operator">-&gt;</span> <span class="token number">5</span>
main <span class="token operator">-&gt;</span> <span class="token number">6</span>
main <span class="token operator">-&gt;</span> <span class="token number">7</span>
main <span class="token operator">-&gt;</span> <span class="token number">8</span>
main <span class="token operator">-&gt;</span> <span class="token number">9</span>
main <span class="token operator">-&gt;</span> <span class="token number">10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>第二个例子在两个线程中并行执行，输出如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>parallel<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token number">1</span>
parallel<span class="token operator">-</span><span class="token number">2</span> <span class="token operator">-&gt;</span> <span class="token number">2</span>
parallel<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token number">3</span>
parallel<span class="token operator">-</span><span class="token number">2</span> <span class="token operator">-&gt;</span> <span class="token number">4</span>
parallel<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token number">5</span>
parallel<span class="token operator">-</span><span class="token number">2</span> <span class="token operator">-&gt;</span> <span class="token number">6</span>
parallel<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token number">7</span>
parallel<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token number">9</span>
parallel<span class="token operator">-</span><span class="token number">2</span> <span class="token operator">-&gt;</span> <span class="token number">8</span>
parallel<span class="token operator">-</span><span class="token number">2</span> <span class="token operator">-&gt;</span> <span class="token number">10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>如果在并行地处理之后，需要退回到一个「正常」的 <code>Flux</code> 而使后续的操作链按非并行模式执行， 你可以对 <code>ParallelFlux</code> 使用 <code>sequential()</code> 方法。</p> <p>注意，当你在对 ParallelFlux 使用一个 <code>Subscriber</code> 而不是基于 lambda 进行订阅（<code>subscribe()</code>） 的时候，<code>sequential()</code> 会自动地被偷偷应用。</p> <p>注意 <code>subscribe(Subscriber&lt;T&gt;)</code> 会合并所有的执行轨道，而 <code>subscribe(Consumer&lt;T&gt;)</code> 会在所有轨道上运行。 如果 <code>subscribe()</code> 方法中是一个 lambda，那么有几个轨道，lambda 就会被执行几次。</p> <p>你还可以使用 <code>groups()</code> 作为 <code>Flux&lt;GroupedFlux&lt;T&gt;&gt;</code> 进入到各个轨道或组里边， 然后可以通过 <code>composeGroup()</code> 添加额外的操作符。</p> <h2 id="替换默认的-schedulers"><a href="#替换默认的-schedulers" class="header-anchor">#</a> 替换默认的 <code>Schedulers</code></h2> <p>就像我们在 <a href="/reactor/core-features/#调度器-schedulers">调度器（Schedulers）</a> 这一节看到的那样， Reactor Core 内置许多 <code>Scheduler</code> 的具体实现。 你可以用形如 <code>new*</code> 的工厂方法来创建调度器，每一种调度器都有一个单例对象，你可以使用单例工厂方法 （比如 <code>Schedulers.elastic()</code> 而不是 <code>Schedulers.newElastic()</code>）来获取它。</p> <p>当你不明确指定调度器的时候，那些需要调度器的操作符会使用这些默认的单例调度器对象。例如， <code>Flux#delayElements(Duration)</code> 使用的是 <code>Schedulers.parallel()</code> 调度器对象。</p> <p>然而有些情况下，你可能需要「一刀切」（就不用对每一个操作符都传入你自己的调度器作为参数了） 地调整这些默认调度器。 一个典型的例子就是，假设你需要对每一个被调度的任务统计执行时长， 就想把默认的调度器包装一下，然后添加计时功能。</p> <p>那么可以使用 <code>Schedulers.Factory</code> 类来改变默认的调度器。默认情况下，一个 <code>Factory</code> 会使用一些「命名比较直白」 的方法来创建所有的标准 <code>Scheduler</code>。每一个方法你都可以用自己的实现方式来重写。</p> <p>此外，<code>Factory</code> 还提供一个额外的自定义方法 <code>decorateExecutorService</code>。它会在创建每一个 reactor-core 调度器——内部有一个 <code>ScheduledExecutorService</code>（即使是比如用 <code>Schedulers.newParallel()</code> 方法创建的这种非默认的调度器）——的时候被调用。</p> <p>你可以通过调整 <code>ScheduledExecutorService</code> 来改变调度器：（<code>decorateExecutorService</code> 方法）通过一个 <code>Supplier</code> 参数暴露出来，你可以直接绕过这个 supplier 返回你自己的调度器实例，或者用 （<code>Schedulers.ScheduledExecutorService</code> 的）<code>get()</code> 得到默认实例，然后包装它， 这取决于配置的调度器类型。</p> <blockquote><p>当你搞定了一个定制好的 <code>Factory</code> 后，你必须使用 <code>Schedulers.setFactory(Factory)</code> 方法来安装它。</p></blockquote> <p>最后，对于调度器来说，有一个可自定义的 hook：<code>onHandleError</code>。这个 hook 会在提交到这个调度器的 <code>Runnable</code> 任务抛出异常的时候被调用（注意，如果还设置了一个 <code>UncaughtExceptionHandler</code>， 那么它和 hook 都会被调用）。</p> <h2 id="使用全局的-hooks"><a href="#使用全局的-hooks" class="header-anchor">#</a> 使用全局的 Hooks</h2> <p>Reactor 还有另外一类可配置的应用于多种场合的回调，它们都在 <code>Hooks</code> 类中定义，总体来说有三类：</p> <ul><li>丢弃事件的 Hooks</li> <li>内部错误 Hook</li> <li>组装 Hooks</li></ul> <h3 id="丢弃事件的-hooks"><a href="#丢弃事件的-hooks" class="header-anchor">#</a> 丢弃事件的 Hooks</h3> <p>当生成源的操作符不遵从响应式流规范的时候，Dropping hooks（用于处理丢弃事件的 hooks）会被调用。 这种类型的错误是处于正常的执行路径之外的（也就是说它们不能通过 <code>onError</code> 传播）。</p> <p>典型的例子是，假设一个发布者即使在被调用 <code>onCompleted</code> 之后仍然可以通过操作符调用 <code>onNext</code>。 这种情况下，<code>onNext</code> 的值会被 <em>丢弃</em>，如果有多余的 <code>onError</code> 的信号亦是如此。</p> <p>相应的 hook，<code>onNextDropped</code> 以及 <code>onErrorDropped</code>，可以提供一个全局的 <code>Consumer</code>， 以便能够在丢弃的情况发生时进行处理。例如，你可以使用它来对丢弃事件记录日志，或进行资源清理 （使用资源的值可能压根没有到达响应式链的下游）。</p> <p>连续设置两次 hook 的话都会起作用：提供的每一个 consumer 都会被调用。使用 <code>Hooks.resetOn*Dropped()</code> 方法可以将 hooks 全部重置为默认。</p> <h3 id="内部错误-hook"><a href="#内部错误-hook" class="header-anchor">#</a> 内部错误 Hook</h3> <p>如果操作符在执行其 <code>onNext</code>、<code>onError</code> 以及 <code>onComplete</code> 方法的时候抛出异常，那么 <code>onOperatorError</code> 这一个 hook 会被调用。</p> <p>与上一类 hook 不同，这个 hook 还是处在正常的执行路径中的。一个典型的例子就是包含一个 map 函数式的 <code>map</code> 操作符抛出的异常（比如零作为除数），这时候还是会执行到 <code>onError</code> 的。</p> <p>首先，它会将异常传递给 <code>onOperatorError</code>。利用这个 hook 你可以检查这个错误（以及有问题的相关数据）， 并可以 <em>改变</em> 这个异常。当然你还可以做些别的事情，比如记录日志或返回原始异常。</p> <p>注意，<code>onOperatorError</code> hook 也可以被多次设置：你可以提供一个 <code>String</code> 为一个特别的 <code>BiFunction</code> 类型的函数式设置识别符，不同识别符的函数式都会被执行，当然，重复使用一个识别符的话， 则后来的设置会覆盖前边的设置。</p> <p>因此，默认的 hook 可以使用 <code>Hooks.resetOnOperatorError()</code> 方法重置，而提供识别符的 hook 可以使用 <code>Hooks.resetOnOperatorError(String)</code> 方法来重置。</p> <h3 id="组装-hooks"><a href="#组装-hooks" class="header-anchor">#</a> 组装 Hooks</h3> <p>这些组装（assembly） hooks 关联了操作符的生命周期。它们会在一个操作链被组装起来的时候（即实例化的时候） 被调用。每一个新的操作符组装到操作链上的时候，<code>onEachOperator</code> 都会返回一个不同的发布者， 从而可以利用它动态调整操作符。<code>onLastOperator</code> 与之类似，不过只会在被操作链上的最后一个 （<code>subscribe</code> 调用之前的）操作符调用。</p> <p>类似于 <code>onOperatorError</code>，也可以叠加，并且通过识别符来标识。也是用类似的方式重置全部或部分 hooks。</p> <h3 id="预置-hooks"><a href="#预置-hooks" class="header-anchor">#</a> 预置 Hooks</h3> <p><code>Hooks</code> 工具类还提供了一些预置的 hooks。利用他们可以改变一些默认的处理方式，而不用自己 编写 hook：</p> <ul><li><code>onNextDroppedFail()</code>：<code>onNextDropped</code> 通常会抛出 <code>Exceptions.failWithCancel()</code> 异常。 现在它默认还会以 DEBUG 级别对被丢弃的值记录日志。如果想回到原来的只是抛出异常的方式，使用 <code>onNextDroppedFail()</code>。</li> <li><code>onOperatorDebug()</code>: 这个方法会激活 <a href="/reactor/debug/#开启调试模式">开启调试模式</a>。它与 <code>onOperatorError</code> hook 关联，所以调用 <code>resetOnOperatorError()</code> 同时也会重置它。不过它内部也用到了特别的识别符， 你可以通过 <code>resetOnOperatorDebug()</code> 方法来重置它。</li></ul> <h2 id="增加一个-context-到响应式序列"><a href="#增加一个-context-到响应式序列" class="header-anchor">#</a> 增加一个 Context 到响应式序列</h2> <p>当从命令式编程风格切换到响应式编程风格的时候，一个技术上最大的挑战就是线程处理。</p> <p>与习惯做法不同的是，在响应式编程中，一个线程（<code>Thread</code>）可以被用于处理多个同时运行的异步序列 （实际上是非阻塞的）。执行过程也会经常从一个线程切换到另一个线程。</p> <p>这样的情况下，对于开发者来说，如果依赖线程模型中相对「稳定」的特性——比如 <code>ThreadLocal</code> ——就会变得很难。因为它会让你将数据绑定到一个 <strong>线程</strong> 上，所以在响应式环境中使用就变得 比较困难。因此，将使用了 <code>ThreadLocal</code> 的库应用于 Reactor 的时候就会带来新的挑战。通常会更糟， 它用起来效果会更差，甚至会失败。 比如，使用 Logback 的 MDC 来存储日志关联的 ID，就是一个非常符合 这种情况的例子。</p> <p>通常的对 <code>ThreadLocal</code> 的替代方案是将环境相关的数据 <code>C</code>，同业务数据 <code>T</code> 一起置于序列中, 比如使用 <code>Tuple2&lt;T, C&gt;</code>。这种方案看起来并不好，况且会在方法和 <code>Flux</code> 泛型中暴露环境数据信息。</p> <p>自从版本 <code>3.1.0</code>，Reactor 引入了一个类似于 <code>ThreadLocal</code> 的高级功能：<code>Context</code>。它作用于一个 <code>Flux</code> 或一个 <code>Mono</code> 上，而不是应用于一个线程（<code>Thread</code>）。</p> <p>为了说明，这里有个读写 <code>Context</code> 的简单例子：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> r <span class="token operator">=</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span> s <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                   <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> ctx <span class="token operator">-&gt;</span> s <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span>ctx <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>接下来的几个小节，我们来了解 <code>Context</code> 是什么以及如何用，从而最终可以理解上边的例子。</p> <blockquote><p>这是一个主要面向库开发人员的高级功能。这需要开发者对 <code>Subscription</code> 的生命周期 充分理解，并且明白它主要用于 subscription 相关的库。</p></blockquote> <h3 id="context-api"><a href="#context-api" class="header-anchor">#</a> <code>Context</code> API</h3> <p><code>Context</code> 是一个类似于 <code>Map</code>（这种数据结构）的接口：它存储键值（key-value）对，你需要通过 key 来获取值：</p> <ul><li>key 和 value 都是 <code>Object</code> 类型，所以 <code>Context</code> 可以包含任意数量的任意对象。</li> <li><code>Context</code> 是 <strong>不可变的（immutable）</strong>。</li> <li>用 <code>put(Object key, Object value)</code> 方法来存储一个键值对，返回一个新的 <code>Context</code> 对象。 你也可以用 <code>putAll(Context)</code> 方法将两个 context 合并为一个新的 context。</li> <li>用 <code>hasKey(Object key)</code> 方法检查一个 key 是否已经存在。</li> <li>用 <code>getOrDefault(Object key, T defaultValue)</code> 方法取回 key 对应的值（类型转换为 <code>T</code>）， 或在找不到这个 key 的情况下返回一个默认值。</li> <li>用 <code>getOrEmpty(Object key)</code> 来得到一个 <code>Optional&lt;T&gt;</code> （context 会尝试将值转换为 <code>T</code>）。</li> <li>用 <code>delete(Object key)</code> 来删除 key 关联的值，并返回一个新的 <code>Context</code>。</li></ul> <blockquote><p><strong>创建一个</strong> <code>Context</code> 时，你可以用静态方法 <code>Context.of</code> 预先存储最多 5 个键值对。 它接受 2, 4, 6, 8 或 10 个 <code>Object</code> 对象，两两一对作为键值对添加到 <code>Context</code>。  你也可以用 <code>Context.empty()</code> 方法来创建一个空的 <code>Context</code>。</p></blockquote> <h3 id="把-context-绑定到-flux-and-writing"><a href="#把-context-绑定到-flux-and-writing" class="header-anchor">#</a> 把 <code>Context</code> 绑定到 <code>Flux</code> and Writing</h3> <p>为了使用 context，它必须要绑定到一个指定的序列，并且链上的每个操作符都可以访问它。 注意，这里的操作符必须是 Reactor 内置的操作符，因为 <code>Context</code> 是 Reactor 特有的。</p> <p>实际上，一个 <code>Context</code> 是绑定到每一个链中的 <code>Subscriber</code> 上的。 它使用 <code>Subscription</code> 的传播机制来让自己对每一个操作符都可见（从最后一个 <code>subscribe</code> 沿链向上）。</p> <p>为了填充 <code>Context</code> ——只能在订阅时（subscription time）——你需要使用 <code>subscriberContext</code> 操作符。</p> <p><code>subscriberContext(Context)</code> 方法会将你提供的 <code>Context</code> 与来自下游（记住，<code>Context</code> 是从下游 向上游传播的）的 <code>Context</code>合并。 这通过调用 <code>putAll</code> 实现，最后会生成一个新的 <code>Context</code> 给上游。</p> <blockquote><p>你也可以用更高级的 <code>subscriberContext(Function&lt;Context, Context&gt;)</code>。它接受来自下游的 <code>Context</code>，然后你可以根据需要添加或删除值，然后返回新的 <code>Context</code>。你甚至可以返回一个完全不同 的对象，虽然不太建议这样（这样可能影响到依赖这个 <code>Context</code> 的库）。</p></blockquote> <h3 id="读取-context"><a href="#读取-context" class="header-anchor">#</a> 读取 Context</h3> <p>填充 <code>Context</code> 是一方面，读取数据同样重要。多数时候，添加内容到 <code>Context</code> 是最终用户的责任， 但是利用这些信息是库的责任，因为库通常是客户代码的上游。</p> <p>读取 context 数据使用静态方法 <code>Mono.subscriberContext()</code>。</p> <h3 id="简单的例子"><a href="#简单的例子" class="header-anchor">#</a> 简单的例子</h3> <p>本例的初衷是为了让你对如何使用 <code>Context</code> 有个更好的理解。</p> <p>让我们先回头看一下最初的例子：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> r <span class="token operator">=</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span> s <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
                                   <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> ctx <span class="token operator">-&gt;</span> s <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
                <span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span>ctx <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>
            <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol><li>操作链以调用 <code>subscriberContext(Function)</code> 结尾，将 <code>&quot;World&quot;</code> 作为 <code>&quot;message&quot;</code> 这个 key 的 值添加到 <code>Context</code> 中</li> <li>对源调用 <code>flatMap</code> 用 <code>Mono.subscriberContext()</code> 方法拿到 <code>Context</code></li> <li>然后使用 <code>map</code> 读取关联到 <code>&quot;message&quot;</code> 的值，然后与原来的值连接</li> <li>最后 <code>Mono&lt;String&gt;</code> 确实发出了 <code>&quot;Hello World&quot;</code></li></ol> <blockquote><p>上边的数字顺序并不是按照代码行顺序排的，这并非错误：它代表了执行顺序。虽然 <code>subscriberContext</code> 是链上的最后一个环节，但确实最先执行的（原因在于 subscription 信号 是从下游向上的）。</p></blockquote> <p>注意在你的操作链中，<strong>写入</strong> 与 <strong>读取</strong> <code>Context</code> 的 <strong>相对位置</strong> 很重要：因为 <code>Context</code> 是不可变的，它的内容只能被上游的操作符看到，如下例所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> r <span class="token operator">=</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span>
                     <span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span>ctx <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
                     <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span> s <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> ctx <span class="token operator">-&gt;</span> s <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;Stranger&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

<span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Stranger&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
            <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol><li>写入 <code>Context</code> 的位置太靠上了</li> <li>所以在 <code>flatMap</code> 就没有 key 关联的值，使用了默认值</li> <li>结果 <code>Mono&lt;String&gt;</code> 发出了 <code>&quot;Hello Stranger&quot;</code></li></ol> <p>下面的例子同样说明了 <code>Context</code> 的不可变性（<code>Mono.subscriberContext()</code> 总是返回由 <code>subscriberContext</code> 配置的 <code>Context</code>）：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> r <span class="token operator">=</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> ctx <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
        <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span> ctx <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> ctx <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token string">&quot;Default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>

<span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token string">&quot;Default&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>
        <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol><li>拿到 <code>Context</code></li> <li>在 <code>map</code> 方法中我们尝试修改它</li> <li>在 <code>flatMap</code> 中再次获取 <code>Context</code></li> <li>读取 <code>Context</code> 中可能的值</li> <li>值从来没有被设置为 <code>&quot;Hello&quot;</code></li></ol> <p>类似的，如果多次对 <code>Context</code> 中的同一个 key 赋值的话，要看 <strong>写入的相对顺序</strong> ： 读取 <code>Context</code> 的操作符只能拿到下游最近的一次写入的值，如下例所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> r <span class="token operator">=</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span> s <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                   <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> ctx <span class="token operator">-&gt;</span> s <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span>ctx <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;Reactor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
                <span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span>ctx <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

<span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Reactor&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
            <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol><li>写入 <code>&quot;message&quot;</code> 的值</li> <li>另一次写入 <code>&quot;message&quot;</code> 的值。</li> <li><code>map</code> 方法值能拿到下游最近的一次写入的值： <code>&quot;Reactor&quot;</code></li></ol> <p>这里，首先 <code>Context</code> 中的 key 被赋值 <code>&quot;World&quot;</code>。然后订阅信号（subscription signal）向上游 移动，又发生了另一次写入。这次生成了第二个不变的 <code>Context</code>，里边的值是 <code>&quot;Reactor&quot;</code>。之后， 数据开始流动， <code>flatMap</code> 拿到最近的 <code>Context</code> ，也就是第二个值为 <code>Reactor</code> 的 <code>Context</code>。</p> <p>你可能会觉得 <code>Context</code> 是与数据信号一块传播的。如果是那样的话，在两次写入操作中间加入的一个 <code>flatMap</code> 会使用最上游的这个 <code>Context</code>。但并不是这样的，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> r <span class="token operator">=</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span>
                     <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span> s <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> ctx <span class="token operator">-&gt;</span> s <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
                     <span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span>ctx <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;Reactor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
                     <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span> s <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> ctx <span class="token operator">-&gt;</span> s <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>
                     <span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span>ctx <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Reactor World&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>
            <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol><li>这里是第一次赋值</li> <li>这里是第二次赋值</li> <li>第一个 <code>flatMap</code> 看到的是第二次的赋值</li> <li>第二个 <code>flatMap</code> 将上一个的结果与 <strong>第一次赋值</strong> 的 context 值连接</li> <li><code>Mono</code> 发出的是 <code>&quot;Hello Reactor World&quot;</code></li></ol> <p>原因在于 <code>Context</code> 是与 <code>Subscriber</code> 关联的，而每一个操作符访问的 <code>Context</code> 来自其下游的 <code>Subscriber</code>。</p> <p>最后一个有意思的传播方式是，对 <code>Context</code> 的赋值也可以在一个 <code>flatMap</code> <strong>内部</strong>，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> r <span class="token operator">=</span>
        <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span> s <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> ctx <span class="token operator">-&gt;</span> s <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span> s <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> ctx <span class="token operator">-&gt;</span> s <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span>ctx <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;Reactor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span>ctx <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

<span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World Reactor&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol><li>这个 <code>subscriberContext</code> 不会影响所在 <code>flatMap</code> 之外的任何东西</li> <li>这个 <code>subscriberContext</code> 会影响主序列的 <code>Context</code></li></ol> <p>上边的例子中，最后发出的值是 <code>&quot;Hello World Reactor&quot;</code> 而不是 &quot;Hello Reactor World&quot;，因为赋值 &quot;Reactor&quot; 的 <code>subscriberContext</code> 是作用于第二个 <code>flatMap</code> 的内部序列的。所以不会在主序列可见/ 传播，第一个 <code>flatMap</code> 也看不到它。传播（Propagation） + 不可变性（immutability）将类似 <code>flatMap</code> 这样的操作符中的创建的内部序列中的 <code>Context</code> 与外部隔离开来。</p> <h3 id="完整的例子"><a href="#完整的例子" class="header-anchor">#</a> 完整的例子</h3> <p>让我们来看一个实际的从 <code>Context</code> 中读取值的例子：一个响应式的 HTTP 客户端将一个 <code>Mono&lt;String&gt;</code> （用于 <code>PUT</code> 请求）作为数据源，同时通过一个特定的 key 使用 Context 将关联的ID信息放入请求头中。</p> <p>从用户角度，是这样调用的：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">doPut</span><span class="token punctuation">(</span><span class="token string">&quot;www.example.com&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">&quot;Walter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>为了传播一个关联ID，应该这样调用：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">doPut</span><span class="token punctuation">(</span><span class="token string">&quot;www.example.com&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">&quot;Walter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token constant">HTTP_CORRELATION_ID</span><span class="token punctuation">,</span> <span class="token string">&quot;2-j3r9afaf92j-afkaf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>由上可见，用户代码使用了 <code>subscriberContext</code> 来为 <code>Context</code> 的 <code>HTTP_CORRELATION_ID</code> 赋值。上游的操作符是一个由 HTTP 客户端库返回的 <code>Mono&lt;Tuple2&lt;Integer, String&gt;&gt;</code> （一个简化的 HTTP 响应）。所以能够正确将信息从用户代码传递给库代码。</p> <p>下边的例子演示了从库的角度由 context 读取值的模拟代码，如果能够找到关联ID，则「增加请求」：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">HTTP_CORRELATION_ID</span> <span class="token operator">=</span> <span class="token string">&quot;reactive.http.library.correlationId&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">doPut</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Optional</span><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> dataAndContext <span class="token operator">=</span>
                        data<span class="token punctuation">.</span><span class="token function">zipWith</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
                                         <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>c <span class="token operator">-&gt;</span> c<span class="token punctuation">.</span><span class="token function">getOrEmpty</span><span class="token punctuation">(</span><span class="token constant">HTTP_CORRELATION_ID</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

        <span class="token keyword">return</span> dataAndContext
                        <span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dac<span class="token punctuation">,</span> sink<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span>dac<span class="token punctuation">.</span><span class="token function">getT2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 3</span>
                                        sink<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&quot;PUT &lt;&quot;</span> <span class="token operator">+</span> dac<span class="token punctuation">.</span><span class="token function">getT1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&gt; sent to &quot;</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">&quot; with header X-Correlation-ID = &quot;</span> <span class="token operator">+</span> dac<span class="token punctuation">.</span><span class="token function">getT2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                                <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                        sink<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&quot;PUT &lt;&quot;</span> <span class="token operator">+</span> dac<span class="token punctuation">.</span><span class="token function">getT1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&gt; sent to &quot;</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                                sink<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>msg <span class="token operator">-&gt;</span> <span class="token class-name">Tuples</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ol><li>用 <code>Mono.subscriberContext()</code> 拿到 <code>Context</code></li> <li>提取出关联ID的值——是一个 <code>Optional</code></li> <li>如果值存在，那么就将其加入请求头</li></ol> <p>在这段库代码片段中，你可以看到它是如何将 <code>Mono</code> 和 <code>Mono.subscriberContext()</code> zip 起来的。 返回的是一个 <code>Tuple2&lt;String, Context&gt;</code>，这个 <code>Context</code> 包含来自下游的 <code>HTTP_CORRELATION_ID</code> 的值。</p> <p>库代码接着用 <code>map</code> 读取出那个 key 的值 <code>Optional&lt;String&gt;</code>，如果值存在，将其作为 <code>X-Correlation-ID</code> 请求头。 最后一块而用 <code>handle</code> 来处理。</p> <p>用来验证上边的库代码的测试程序如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextForLibraryReactivePut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> put <span class="token operator">=</span> <span class="token function">doPut</span><span class="token punctuation">(</span><span class="token string">&quot;www.example.com&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">&quot;Walter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token constant">HTTP_CORRELATION_ID</span><span class="token punctuation">,</span> <span class="token string">&quot;2-j3r9afaf92j-afkaf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> t<span class="token punctuation">.</span><span class="token function">getT1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Tuple2</span><span class="token operator">::</span><span class="token function">getT2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">StepVerifier</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>put<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">expectNext</span><span class="token punctuation">(</span><span class="token string">&quot;PUT &lt;Walter&gt; sent to www.example.com with header X-Correlation-ID = 2-j3r9afaf92j-afkaf&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">verifyComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="空值安全"><a href="#空值安全" class="header-anchor">#</a> 空值安全</h2> <p>虽然 Java 的类型系统没有表达空值安全（null-safety）的机制，但是 Reactor 现在提供了基于注解的用于声明 「可能为空（nullability）」的 API，类似于 Spring Framework 5 中提供的 API。</p> <p>Reactor 自身就用到了这些注解，你也可以将其用于任何基于 Reactor 的自己的空值安全的 Java API 中。 不过，在 <strong>方法体内部</strong> 对「可能为空」的类型的使用就不在这一特性的范围内了。</p> <p>这些注解是基于 <a href="https://jcp.org/en/jsr/detail?id=305" target="_blank" rel="noopener noreferrer">JSR 305<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的注解（是受类似 IntelliJ IDEA 这样的工具支持的 JSR）作为元注解（meta-annotated）的。当 Java 开发者在编写空值安全的代码时， 它们能够提供有用的警告信息，以便避免在运行时（runtime）出现 <code>NullPointerException</code> 异常。 JSR 305 元注解使得工具提供商可以以一种通用的方式提供对空值安全的支持，从而 Reactor 的注解就不用重复造轮子了。</p> <blockquote><p>对于 Kotlin 1.1.5+，需要（同时也推荐）在项目 classpath 中添加对 JSR 305 的依赖。</p></blockquote> <p>它们也可在 Kotlin 中使用，Kotlin 原生支持 <a href="https://kotlinlang.org/docs/reference/null-safety.html" target="_blank" rel="noopener noreferrer">空值安全<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。具体请参考 <a href="/reactor/kotlin-support/#null-值安全">Null 值安全</a> 。</p> <p><code>reactor.util.annotation</code> 包提供以下注解：</p> <ul><li><a href="https://projectreactor.io/docs/core/release/api/reactor/util/annotation/NonNull.html" target="_blank" rel="noopener noreferrer"><code>@NonNull</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 表明一个具体的参数、返回值或域值不能为 <code>null</code>。（如果参数或返回值应用了 <code>@NonNullApi</code> 则无需再加它）</li> <li><a href="https://projectreactor.io/docs/core/release/api/reactor/util/annotation/Nullable.html" target="_blank" rel="noopener noreferrer"><code>@Nullable</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 表明一个参数、返回值或域值可以为 <code>null</code></li> <li><a href="https://projectreactor.io/docs/core/release/api/reactor/util/annotation/NonNullApi.html" target="_blank" rel="noopener noreferrer"><code>@NonNullApi</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个包级别的注解，表明默认情况下参数或返回值不能为 <code>null</code></li></ul> <blockquote><p>（Reactor 的空值安全的注解）对于通用类型参数（generic type arguments）、可变参数（varargs），以及数组元素（array elements） 尚不支持。参考 <a href="https://github.com/reactor/reactor-core/issues/878" target="_blank" rel="noopener noreferrer">issue #878<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 查看最新信息。</p></blockquote></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Somnus711/Somnus711.github.io/edit/master/docs/30.框架/60.响应式框架 - Reactor/13.Reactor - 高级特性与概念.md" target="_blank" rel="noopener noreferrer">编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=Reactor" title="标签">#Reactor</a></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2025/04/06, 01:04:59</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/reactor/debug/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Reactor - 调试 Reactor</div></a> <a href="/reactor/operators-summary/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Reactor - 操作符总结</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/reactor/debug/" class="prev">Reactor - 调试 Reactor</a></span> <span class="next"><a href="/reactor/operators-summary/">Reactor - 操作符总结</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/ep/magic-change/"><div>
            技术随笔 - Element Plus 修改包名
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">11-02</span></dt></dl><dl><dd>02</dd> <dt><a href="/reactor/extensibility/"><div>
            Reactor - 扩展性
            <!----></div></a> <span class="date">11-02</span></dt></dl><dl><dd>03</dd> <dt><a href="/reactor/best-practices/"><div>
            Reactor - 最佳实践
            <!----></div></a> <span class="date">11-02</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:haoyuan1996@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Somnus711" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2025
    <span>Somnus Haoyuan | <a href="https://github.com/Somnus711/Somnus711.github.io/blob/main/LICENSE" target="_blank">MIT
            License</a><br />
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802034042"
            style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img
                src="https://cdn.jsdelivr.net/gh/Somnus711/picx-image-hosting@master/blog-pic/备案图标.3ph98jsceq0w.webp" style="float:left;" />
            <span>京公网安备 11010802034042号</span>
        </a>
        <a target="_blank" href="https://beian.miit.gov.cn"
            style="display:inline-block;text-decoration:none;height:20px;line-height:20px;padding-left: 10px;">
            <span>京ICP备2025120692号-1</span></a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><div></div><div></div><div id="tcomment"></div><!----><div></div></div></div>
    <script src="/assets/js/app.40d6eb57.js" defer></script><script src="/assets/js/2.84f16386.js" defer></script><script src="/assets/js/248.5a48e87f.js" defer></script><script src="/assets/js/15.107d5767.js" defer></script><script src="/assets/js/5.1ffba6c1.js" defer></script><script src="/assets/js/9.dba8a9bf.js" defer></script><script src="/assets/js/12.3f1ed9aa.js" defer></script>
  </body>
</html>
