<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx - 部署与集群 | Haoyuan&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <noscript><meta http-equiv="refresh" content="0; url=/noscript.html"><style>.theme-vdoing-content { display:none }</style></noscript>
    <script src="https://cdn.jsdelivr.net/npm/twikoo@1.6.41/dist/twikoo.all.min.js"></script>
    <script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?720c7013e4bdca4370c380ffa206fbd7";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script>
    <meta name="description" content="Somnus Haoyuan个人博客, VuePress搭建, 使用了 Vdoing 主题, 学习Java, AI大模型等相关知识, 记录生活和技术路程, 同时分享编程技巧。">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="Web个人学习博客，学习是一件快乐的事情。">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.6aa5acdd.css" as="style"><link rel="preload" href="/assets/js/app.40d6eb57.js" as="script"><link rel="preload" href="/assets/js/2.84f16386.js" as="script"><link rel="preload" href="/assets/js/236.c8e24b2a.js" as="script"><link rel="preload" href="/assets/js/15.107d5767.js" as="script"><link rel="preload" href="/assets/js/5.1ffba6c1.js" as="script"><link rel="preload" href="/assets/js/9.dba8a9bf.js" as="script"><link rel="preload" href="/assets/js/12.3f1ed9aa.js" as="script"><link rel="prefetch" href="/assets/js/10.2faf032d.js"><link rel="prefetch" href="/assets/js/100.20bf2323.js"><link rel="prefetch" href="/assets/js/101.58e9195d.js"><link rel="prefetch" href="/assets/js/102.934f4e2d.js"><link rel="prefetch" href="/assets/js/103.2e1edf2f.js"><link rel="prefetch" href="/assets/js/104.f11cb866.js"><link rel="prefetch" href="/assets/js/105.f031400c.js"><link rel="prefetch" href="/assets/js/106.8c306f6f.js"><link rel="prefetch" href="/assets/js/107.4cbb12e2.js"><link rel="prefetch" href="/assets/js/108.013594b5.js"><link rel="prefetch" href="/assets/js/109.855fb1f7.js"><link rel="prefetch" href="/assets/js/11.8d4c884c.js"><link rel="prefetch" href="/assets/js/110.169f17cd.js"><link rel="prefetch" href="/assets/js/111.f3bffe9c.js"><link rel="prefetch" href="/assets/js/112.b05741ea.js"><link rel="prefetch" href="/assets/js/113.c4ea6307.js"><link rel="prefetch" href="/assets/js/114.70c200f9.js"><link rel="prefetch" href="/assets/js/115.10d6bcd7.js"><link rel="prefetch" href="/assets/js/116.0929f9ea.js"><link rel="prefetch" href="/assets/js/117.61aa7090.js"><link rel="prefetch" href="/assets/js/118.eccb075c.js"><link rel="prefetch" href="/assets/js/119.fef47816.js"><link rel="prefetch" href="/assets/js/120.372cb96d.js"><link rel="prefetch" href="/assets/js/121.2560116c.js"><link rel="prefetch" href="/assets/js/122.726e3fde.js"><link rel="prefetch" href="/assets/js/123.6de6a113.js"><link rel="prefetch" href="/assets/js/124.d52d8b46.js"><link rel="prefetch" href="/assets/js/125.409b7367.js"><link rel="prefetch" href="/assets/js/126.c4e734c2.js"><link rel="prefetch" href="/assets/js/127.13e37428.js"><link rel="prefetch" href="/assets/js/128.f035adf7.js"><link rel="prefetch" href="/assets/js/129.fefb2424.js"><link rel="prefetch" href="/assets/js/13.06f0d806.js"><link rel="prefetch" href="/assets/js/130.bb7d196c.js"><link rel="prefetch" href="/assets/js/131.7850d655.js"><link rel="prefetch" href="/assets/js/132.1009bf67.js"><link rel="prefetch" href="/assets/js/133.a61ca829.js"><link rel="prefetch" href="/assets/js/134.83670718.js"><link rel="prefetch" href="/assets/js/135.476146e2.js"><link rel="prefetch" href="/assets/js/136.1593b8d9.js"><link rel="prefetch" href="/assets/js/137.9bc3b9a4.js"><link rel="prefetch" href="/assets/js/138.05c298a8.js"><link rel="prefetch" href="/assets/js/139.baa0f361.js"><link rel="prefetch" href="/assets/js/14.e8a14911.js"><link rel="prefetch" href="/assets/js/140.f7a1498f.js"><link rel="prefetch" href="/assets/js/141.d1117262.js"><link rel="prefetch" href="/assets/js/142.b990b892.js"><link rel="prefetch" href="/assets/js/143.3e0e3d6c.js"><link rel="prefetch" href="/assets/js/144.3c99f5d1.js"><link rel="prefetch" href="/assets/js/145.9efc9743.js"><link rel="prefetch" href="/assets/js/146.1b85bb65.js"><link rel="prefetch" href="/assets/js/147.552bbe6f.js"><link rel="prefetch" href="/assets/js/148.38c079c9.js"><link rel="prefetch" href="/assets/js/149.8a32fdf3.js"><link rel="prefetch" href="/assets/js/150.d73e6d70.js"><link rel="prefetch" href="/assets/js/151.139e669e.js"><link rel="prefetch" href="/assets/js/152.6fe2e61f.js"><link rel="prefetch" href="/assets/js/153.e88f4410.js"><link rel="prefetch" href="/assets/js/154.143abe60.js"><link rel="prefetch" href="/assets/js/155.35c81a23.js"><link rel="prefetch" href="/assets/js/156.f0e2d6ad.js"><link rel="prefetch" href="/assets/js/157.468fb051.js"><link rel="prefetch" href="/assets/js/158.cd86d09f.js"><link rel="prefetch" href="/assets/js/159.833f916a.js"><link rel="prefetch" href="/assets/js/16.f07b2571.js"><link rel="prefetch" href="/assets/js/160.aa4c01ba.js"><link rel="prefetch" href="/assets/js/161.bbc9ee08.js"><link rel="prefetch" href="/assets/js/162.41293d9d.js"><link rel="prefetch" href="/assets/js/163.cbfb7d74.js"><link rel="prefetch" href="/assets/js/164.aad4d4b8.js"><link rel="prefetch" href="/assets/js/165.3b69b465.js"><link rel="prefetch" href="/assets/js/166.646fb23c.js"><link rel="prefetch" href="/assets/js/167.c874eb18.js"><link rel="prefetch" href="/assets/js/168.cf29dd2c.js"><link rel="prefetch" href="/assets/js/169.d10f2b80.js"><link rel="prefetch" href="/assets/js/17.84d94fc1.js"><link rel="prefetch" href="/assets/js/170.69f2f0de.js"><link rel="prefetch" href="/assets/js/171.d05e324a.js"><link rel="prefetch" href="/assets/js/172.213b6735.js"><link rel="prefetch" href="/assets/js/173.bdb037f2.js"><link rel="prefetch" href="/assets/js/174.90dd7a19.js"><link rel="prefetch" href="/assets/js/175.65e79e89.js"><link rel="prefetch" href="/assets/js/176.6e21166e.js"><link rel="prefetch" href="/assets/js/177.efb7d4d2.js"><link rel="prefetch" href="/assets/js/178.2500c230.js"><link rel="prefetch" href="/assets/js/179.9d6c29aa.js"><link rel="prefetch" href="/assets/js/18.bb0be2bd.js"><link rel="prefetch" href="/assets/js/180.8935ec8e.js"><link rel="prefetch" href="/assets/js/181.0ba3667a.js"><link rel="prefetch" href="/assets/js/182.1527192a.js"><link rel="prefetch" href="/assets/js/183.e32e0b1a.js"><link rel="prefetch" href="/assets/js/184.f16730e1.js"><link rel="prefetch" href="/assets/js/185.6817fe7e.js"><link rel="prefetch" href="/assets/js/186.06f91832.js"><link rel="prefetch" href="/assets/js/187.b2e68c56.js"><link rel="prefetch" href="/assets/js/188.c459a7b2.js"><link rel="prefetch" href="/assets/js/189.c5dc9c9a.js"><link rel="prefetch" href="/assets/js/19.babf254d.js"><link rel="prefetch" href="/assets/js/190.539ad7b9.js"><link rel="prefetch" href="/assets/js/191.d4fa3d3f.js"><link rel="prefetch" href="/assets/js/192.904f7b4f.js"><link rel="prefetch" href="/assets/js/193.cc14cf04.js"><link rel="prefetch" href="/assets/js/194.11881e6e.js"><link rel="prefetch" href="/assets/js/195.78172201.js"><link rel="prefetch" href="/assets/js/196.79388c52.js"><link rel="prefetch" href="/assets/js/197.93ca4c41.js"><link rel="prefetch" href="/assets/js/198.452abacb.js"><link rel="prefetch" href="/assets/js/199.6ef2d196.js"><link rel="prefetch" href="/assets/js/20.5e77ec48.js"><link rel="prefetch" href="/assets/js/200.0656fb6f.js"><link rel="prefetch" href="/assets/js/201.19f892f2.js"><link rel="prefetch" href="/assets/js/202.ece43be4.js"><link rel="prefetch" href="/assets/js/203.d5298504.js"><link rel="prefetch" href="/assets/js/204.3d2dc50d.js"><link rel="prefetch" href="/assets/js/205.d24257e6.js"><link rel="prefetch" href="/assets/js/206.bacdf227.js"><link rel="prefetch" href="/assets/js/207.6fd49f37.js"><link rel="prefetch" href="/assets/js/208.c4d1371e.js"><link rel="prefetch" href="/assets/js/209.efc2bdb7.js"><link rel="prefetch" href="/assets/js/21.b614b7ce.js"><link rel="prefetch" href="/assets/js/210.ff884ca2.js"><link rel="prefetch" href="/assets/js/211.579d567a.js"><link rel="prefetch" href="/assets/js/212.b23d9c7a.js"><link rel="prefetch" href="/assets/js/213.f972e645.js"><link rel="prefetch" href="/assets/js/214.677ab8e4.js"><link rel="prefetch" href="/assets/js/215.8317429b.js"><link rel="prefetch" href="/assets/js/216.fe793ca1.js"><link rel="prefetch" href="/assets/js/217.d15bd553.js"><link rel="prefetch" href="/assets/js/218.f2476c1a.js"><link rel="prefetch" href="/assets/js/219.5de46d42.js"><link rel="prefetch" href="/assets/js/22.e14f8d0d.js"><link rel="prefetch" href="/assets/js/220.c49bbd40.js"><link rel="prefetch" href="/assets/js/221.4004aa7d.js"><link rel="prefetch" href="/assets/js/222.5d16df13.js"><link rel="prefetch" href="/assets/js/223.cb628b00.js"><link rel="prefetch" href="/assets/js/224.a6d24d03.js"><link rel="prefetch" href="/assets/js/225.d2bacd2b.js"><link rel="prefetch" href="/assets/js/226.8d5b24c0.js"><link rel="prefetch" href="/assets/js/227.76f901fc.js"><link rel="prefetch" href="/assets/js/228.9fe5796a.js"><link rel="prefetch" href="/assets/js/229.441566ae.js"><link rel="prefetch" href="/assets/js/23.ffcd828d.js"><link rel="prefetch" href="/assets/js/230.af5be7d3.js"><link rel="prefetch" href="/assets/js/231.836eacb5.js"><link rel="prefetch" href="/assets/js/232.e71d875f.js"><link rel="prefetch" href="/assets/js/233.c0f4811a.js"><link rel="prefetch" href="/assets/js/234.393292da.js"><link rel="prefetch" href="/assets/js/235.f0410328.js"><link rel="prefetch" href="/assets/js/237.c7511291.js"><link rel="prefetch" href="/assets/js/238.dcf9d74f.js"><link rel="prefetch" href="/assets/js/239.89c3f7fb.js"><link rel="prefetch" href="/assets/js/24.d2488dd7.js"><link rel="prefetch" href="/assets/js/240.6a231b35.js"><link rel="prefetch" href="/assets/js/241.9518dd8b.js"><link rel="prefetch" href="/assets/js/242.49fee092.js"><link rel="prefetch" href="/assets/js/243.99b57f78.js"><link rel="prefetch" href="/assets/js/244.dffff977.js"><link rel="prefetch" href="/assets/js/245.cdcb59f8.js"><link rel="prefetch" href="/assets/js/246.ee61d776.js"><link rel="prefetch" href="/assets/js/247.03b13721.js"><link rel="prefetch" href="/assets/js/248.5a48e87f.js"><link rel="prefetch" href="/assets/js/249.cd1b3546.js"><link rel="prefetch" href="/assets/js/25.c4ac0557.js"><link rel="prefetch" href="/assets/js/250.204cda9d.js"><link rel="prefetch" href="/assets/js/251.cf5a43ea.js"><link rel="prefetch" href="/assets/js/252.e87cba9e.js"><link rel="prefetch" href="/assets/js/253.31cd4b77.js"><link rel="prefetch" href="/assets/js/254.bc198d0d.js"><link rel="prefetch" href="/assets/js/255.555f461c.js"><link rel="prefetch" href="/assets/js/256.35549c82.js"><link rel="prefetch" href="/assets/js/257.eb8b7f14.js"><link rel="prefetch" href="/assets/js/258.079163a3.js"><link rel="prefetch" href="/assets/js/259.855bf637.js"><link rel="prefetch" href="/assets/js/26.bbaa3da7.js"><link rel="prefetch" href="/assets/js/260.8dbdaa34.js"><link rel="prefetch" href="/assets/js/261.3a3a3d48.js"><link rel="prefetch" href="/assets/js/262.ff4335e2.js"><link rel="prefetch" href="/assets/js/263.4e2cc7b6.js"><link rel="prefetch" href="/assets/js/264.8bf179e4.js"><link rel="prefetch" href="/assets/js/265.a0d8d94a.js"><link rel="prefetch" href="/assets/js/266.c7cb4303.js"><link rel="prefetch" href="/assets/js/267.cd833024.js"><link rel="prefetch" href="/assets/js/268.18023bf7.js"><link rel="prefetch" href="/assets/js/269.d698565e.js"><link rel="prefetch" href="/assets/js/27.cbc4cccc.js"><link rel="prefetch" href="/assets/js/270.4f42ac21.js"><link rel="prefetch" href="/assets/js/271.01513156.js"><link rel="prefetch" href="/assets/js/272.89b02542.js"><link rel="prefetch" href="/assets/js/273.d97ca2b8.js"><link rel="prefetch" href="/assets/js/274.2d44453c.js"><link rel="prefetch" href="/assets/js/275.0454b122.js"><link rel="prefetch" href="/assets/js/276.2a798428.js"><link rel="prefetch" href="/assets/js/277.1b773039.js"><link rel="prefetch" href="/assets/js/278.85318522.js"><link rel="prefetch" href="/assets/js/279.0b9b7dd0.js"><link rel="prefetch" href="/assets/js/28.2811fe35.js"><link rel="prefetch" href="/assets/js/280.34d99bb9.js"><link rel="prefetch" href="/assets/js/281.50efe138.js"><link rel="prefetch" href="/assets/js/282.730115fe.js"><link rel="prefetch" href="/assets/js/283.51e62999.js"><link rel="prefetch" href="/assets/js/284.a366d7e9.js"><link rel="prefetch" href="/assets/js/285.9f0bb34b.js"><link rel="prefetch" href="/assets/js/286.723a14e7.js"><link rel="prefetch" href="/assets/js/287.787b390a.js"><link rel="prefetch" href="/assets/js/288.3eab7c63.js"><link rel="prefetch" href="/assets/js/289.eb4897c8.js"><link rel="prefetch" href="/assets/js/29.553c7a36.js"><link rel="prefetch" href="/assets/js/290.3f12b330.js"><link rel="prefetch" href="/assets/js/291.aecfc068.js"><link rel="prefetch" href="/assets/js/292.cf2ea18c.js"><link rel="prefetch" href="/assets/js/293.a7576751.js"><link rel="prefetch" href="/assets/js/294.59a2ea07.js"><link rel="prefetch" href="/assets/js/295.21aafb3b.js"><link rel="prefetch" href="/assets/js/296.9d03ef74.js"><link rel="prefetch" href="/assets/js/297.e5333eaa.js"><link rel="prefetch" href="/assets/js/298.6b331403.js"><link rel="prefetch" href="/assets/js/299.aed7fe75.js"><link rel="prefetch" href="/assets/js/3.91d9010e.js"><link rel="prefetch" href="/assets/js/30.f752542d.js"><link rel="prefetch" href="/assets/js/300.4b43249a.js"><link rel="prefetch" href="/assets/js/301.8a2d29aa.js"><link rel="prefetch" href="/assets/js/302.2ebd826a.js"><link rel="prefetch" href="/assets/js/303.4bf03f68.js"><link rel="prefetch" href="/assets/js/304.842e0021.js"><link rel="prefetch" href="/assets/js/305.0689927e.js"><link rel="prefetch" href="/assets/js/306.9fe73451.js"><link rel="prefetch" href="/assets/js/307.d6dfc95b.js"><link rel="prefetch" href="/assets/js/308.f6b5fa22.js"><link rel="prefetch" href="/assets/js/309.f0a9e8bf.js"><link rel="prefetch" href="/assets/js/31.efc35430.js"><link rel="prefetch" href="/assets/js/310.b6a97346.js"><link rel="prefetch" href="/assets/js/311.e09ede20.js"><link rel="prefetch" href="/assets/js/312.9ede7559.js"><link rel="prefetch" href="/assets/js/313.70d997db.js"><link rel="prefetch" href="/assets/js/314.8f1cb40a.js"><link rel="prefetch" href="/assets/js/315.3dcbc212.js"><link rel="prefetch" href="/assets/js/316.503dd0d9.js"><link rel="prefetch" href="/assets/js/317.a2628cdc.js"><link rel="prefetch" href="/assets/js/318.79498962.js"><link rel="prefetch" href="/assets/js/319.6383a4d8.js"><link rel="prefetch" href="/assets/js/32.2e7f0ecf.js"><link rel="prefetch" href="/assets/js/320.df7b195d.js"><link rel="prefetch" href="/assets/js/321.a3a665d5.js"><link rel="prefetch" href="/assets/js/322.5f4bb853.js"><link rel="prefetch" href="/assets/js/323.08fc2754.js"><link rel="prefetch" href="/assets/js/324.2ee64ecf.js"><link rel="prefetch" href="/assets/js/325.0645a604.js"><link rel="prefetch" href="/assets/js/326.510326c5.js"><link rel="prefetch" href="/assets/js/327.58ead103.js"><link rel="prefetch" href="/assets/js/328.9c763bc9.js"><link rel="prefetch" href="/assets/js/329.8d27c776.js"><link rel="prefetch" href="/assets/js/33.0fb3ddd2.js"><link rel="prefetch" href="/assets/js/330.4b69506d.js"><link rel="prefetch" href="/assets/js/331.f4e9123c.js"><link rel="prefetch" href="/assets/js/332.decc5f74.js"><link rel="prefetch" href="/assets/js/333.e729cfe0.js"><link rel="prefetch" href="/assets/js/334.a6d25832.js"><link rel="prefetch" href="/assets/js/335.863ce340.js"><link rel="prefetch" href="/assets/js/336.e1fdfcce.js"><link rel="prefetch" href="/assets/js/337.7ec69ad4.js"><link rel="prefetch" href="/assets/js/338.6279e3b4.js"><link rel="prefetch" href="/assets/js/339.9b23235d.js"><link rel="prefetch" href="/assets/js/34.19748377.js"><link rel="prefetch" href="/assets/js/340.7b6c78dc.js"><link rel="prefetch" href="/assets/js/341.1e4bac65.js"><link rel="prefetch" href="/assets/js/342.b79997de.js"><link rel="prefetch" href="/assets/js/343.db33f886.js"><link rel="prefetch" href="/assets/js/344.13b20d62.js"><link rel="prefetch" href="/assets/js/345.c334203e.js"><link rel="prefetch" href="/assets/js/346.536c03d6.js"><link rel="prefetch" href="/assets/js/347.2184fbfa.js"><link rel="prefetch" href="/assets/js/348.57ccabdc.js"><link rel="prefetch" href="/assets/js/349.99b549fc.js"><link rel="prefetch" href="/assets/js/35.80d3df6e.js"><link rel="prefetch" href="/assets/js/350.a46457f1.js"><link rel="prefetch" href="/assets/js/351.9da55b6a.js"><link rel="prefetch" href="/assets/js/352.f3798216.js"><link rel="prefetch" href="/assets/js/353.f7b95ddb.js"><link rel="prefetch" href="/assets/js/354.436f104a.js"><link rel="prefetch" href="/assets/js/355.8951e7a3.js"><link rel="prefetch" href="/assets/js/356.d2f3e4eb.js"><link rel="prefetch" href="/assets/js/357.c14203c7.js"><link rel="prefetch" href="/assets/js/358.299282e3.js"><link rel="prefetch" href="/assets/js/359.c9bed611.js"><link rel="prefetch" href="/assets/js/36.1013dc0b.js"><link rel="prefetch" href="/assets/js/360.ccfb13a8.js"><link rel="prefetch" href="/assets/js/361.05ec179c.js"><link rel="prefetch" href="/assets/js/362.427072fc.js"><link rel="prefetch" href="/assets/js/363.0ee122f9.js"><link rel="prefetch" href="/assets/js/364.0017ecc8.js"><link rel="prefetch" href="/assets/js/365.1230ac7c.js"><link rel="prefetch" href="/assets/js/366.f6914c2e.js"><link rel="prefetch" href="/assets/js/367.9fe0341d.js"><link rel="prefetch" href="/assets/js/368.a21bf199.js"><link rel="prefetch" href="/assets/js/369.39fe53ec.js"><link rel="prefetch" href="/assets/js/37.9a45ef0a.js"><link rel="prefetch" href="/assets/js/370.e701eeda.js"><link rel="prefetch" href="/assets/js/371.b90c9d30.js"><link rel="prefetch" href="/assets/js/372.a97bf0b2.js"><link rel="prefetch" href="/assets/js/373.4a798498.js"><link rel="prefetch" href="/assets/js/374.85ab3af8.js"><link rel="prefetch" href="/assets/js/375.43495a72.js"><link rel="prefetch" href="/assets/js/376.6b3cc970.js"><link rel="prefetch" href="/assets/js/377.03779254.js"><link rel="prefetch" href="/assets/js/378.34d40bb8.js"><link rel="prefetch" href="/assets/js/379.ca3a6942.js"><link rel="prefetch" href="/assets/js/38.d845e6b5.js"><link rel="prefetch" href="/assets/js/380.339b99c0.js"><link rel="prefetch" href="/assets/js/381.854ec26a.js"><link rel="prefetch" href="/assets/js/382.479978e6.js"><link rel="prefetch" href="/assets/js/383.01dc63bc.js"><link rel="prefetch" href="/assets/js/384.cb97ac09.js"><link rel="prefetch" href="/assets/js/385.f36cf5f6.js"><link rel="prefetch" href="/assets/js/386.7de0ab17.js"><link rel="prefetch" href="/assets/js/387.39f59b7c.js"><link rel="prefetch" href="/assets/js/388.95497a30.js"><link rel="prefetch" href="/assets/js/389.b448ed5e.js"><link rel="prefetch" href="/assets/js/39.77876eda.js"><link rel="prefetch" href="/assets/js/390.a66c4fc4.js"><link rel="prefetch" href="/assets/js/391.48062b7a.js"><link rel="prefetch" href="/assets/js/392.6e57278e.js"><link rel="prefetch" href="/assets/js/393.234e1194.js"><link rel="prefetch" href="/assets/js/394.b7d318c1.js"><link rel="prefetch" href="/assets/js/395.c164d904.js"><link rel="prefetch" href="/assets/js/396.1fc871e1.js"><link rel="prefetch" href="/assets/js/397.97aba7d4.js"><link rel="prefetch" href="/assets/js/398.f220283d.js"><link rel="prefetch" href="/assets/js/399.c59ca5b2.js"><link rel="prefetch" href="/assets/js/4.f1d08658.js"><link rel="prefetch" href="/assets/js/40.fb9333c4.js"><link rel="prefetch" href="/assets/js/400.da8d06aa.js"><link rel="prefetch" href="/assets/js/401.0d789e46.js"><link rel="prefetch" href="/assets/js/402.4de6e357.js"><link rel="prefetch" href="/assets/js/403.790f264a.js"><link rel="prefetch" href="/assets/js/404.82e81932.js"><link rel="prefetch" href="/assets/js/405.441ea069.js"><link rel="prefetch" href="/assets/js/406.bfadbb65.js"><link rel="prefetch" href="/assets/js/407.38f3a5ec.js"><link rel="prefetch" href="/assets/js/408.ecbffdd6.js"><link rel="prefetch" href="/assets/js/409.cd8ec16c.js"><link rel="prefetch" href="/assets/js/41.206dc183.js"><link rel="prefetch" href="/assets/js/410.3eae7a5b.js"><link rel="prefetch" href="/assets/js/411.4f3a7f1b.js"><link rel="prefetch" href="/assets/js/412.69bf0344.js"><link rel="prefetch" href="/assets/js/413.8c53eacf.js"><link rel="prefetch" href="/assets/js/414.d61f85f6.js"><link rel="prefetch" href="/assets/js/415.89165bcc.js"><link rel="prefetch" href="/assets/js/416.4e791dfd.js"><link rel="prefetch" href="/assets/js/417.45f0c4b2.js"><link rel="prefetch" href="/assets/js/418.48807d9c.js"><link rel="prefetch" href="/assets/js/419.4152ed23.js"><link rel="prefetch" href="/assets/js/42.15a1375e.js"><link rel="prefetch" href="/assets/js/420.96e4dc4d.js"><link rel="prefetch" href="/assets/js/421.f2aa7333.js"><link rel="prefetch" href="/assets/js/422.eb34edb8.js"><link rel="prefetch" href="/assets/js/423.c775b42f.js"><link rel="prefetch" href="/assets/js/424.585c7a0f.js"><link rel="prefetch" href="/assets/js/425.01403622.js"><link rel="prefetch" href="/assets/js/426.7755d4a2.js"><link rel="prefetch" href="/assets/js/427.9f553119.js"><link rel="prefetch" href="/assets/js/428.c8dd4f0c.js"><link rel="prefetch" href="/assets/js/429.3ed285c0.js"><link rel="prefetch" href="/assets/js/43.a03afca7.js"><link rel="prefetch" href="/assets/js/430.467c7eaa.js"><link rel="prefetch" href="/assets/js/431.3cbbe034.js"><link rel="prefetch" href="/assets/js/432.9c40e1ea.js"><link rel="prefetch" href="/assets/js/433.9add6475.js"><link rel="prefetch" href="/assets/js/434.b6cff804.js"><link rel="prefetch" href="/assets/js/435.b1fd54d5.js"><link rel="prefetch" href="/assets/js/436.dcb99738.js"><link rel="prefetch" href="/assets/js/437.9562e869.js"><link rel="prefetch" href="/assets/js/438.1b87f7a1.js"><link rel="prefetch" href="/assets/js/439.51a7f392.js"><link rel="prefetch" href="/assets/js/44.08819acf.js"><link rel="prefetch" href="/assets/js/440.ba244e0b.js"><link rel="prefetch" href="/assets/js/441.6247c292.js"><link rel="prefetch" href="/assets/js/442.317331fe.js"><link rel="prefetch" href="/assets/js/443.66412722.js"><link rel="prefetch" href="/assets/js/444.f12bd7bb.js"><link rel="prefetch" href="/assets/js/445.8dd4cba1.js"><link rel="prefetch" href="/assets/js/446.dc2f7fe1.js"><link rel="prefetch" href="/assets/js/447.4024dc6d.js"><link rel="prefetch" href="/assets/js/448.9f473a57.js"><link rel="prefetch" href="/assets/js/449.2fde71a1.js"><link rel="prefetch" href="/assets/js/45.dbfa99cc.js"><link rel="prefetch" href="/assets/js/450.caa7dbd8.js"><link rel="prefetch" href="/assets/js/451.0509ac4e.js"><link rel="prefetch" href="/assets/js/452.f4535c29.js"><link rel="prefetch" href="/assets/js/453.8feab1b9.js"><link rel="prefetch" href="/assets/js/454.b85825f2.js"><link rel="prefetch" href="/assets/js/455.8398d19c.js"><link rel="prefetch" href="/assets/js/456.b50f3dd0.js"><link rel="prefetch" href="/assets/js/457.ada86b83.js"><link rel="prefetch" href="/assets/js/458.7f24755f.js"><link rel="prefetch" href="/assets/js/459.a5e5c3eb.js"><link rel="prefetch" href="/assets/js/46.8cad9b71.js"><link rel="prefetch" href="/assets/js/460.b42f4a81.js"><link rel="prefetch" href="/assets/js/461.67f0b35b.js"><link rel="prefetch" href="/assets/js/462.1ab358db.js"><link rel="prefetch" href="/assets/js/463.0ac7350c.js"><link rel="prefetch" href="/assets/js/464.45c469a9.js"><link rel="prefetch" href="/assets/js/465.cdd85a89.js"><link rel="prefetch" href="/assets/js/466.81d406f8.js"><link rel="prefetch" href="/assets/js/467.d566f183.js"><link rel="prefetch" href="/assets/js/468.50345fae.js"><link rel="prefetch" href="/assets/js/469.1c7dbd36.js"><link rel="prefetch" href="/assets/js/47.b613df2f.js"><link rel="prefetch" href="/assets/js/470.5cfc2898.js"><link rel="prefetch" href="/assets/js/48.7dd353ac.js"><link rel="prefetch" href="/assets/js/49.c6acb8a5.js"><link rel="prefetch" href="/assets/js/50.f98e787a.js"><link rel="prefetch" href="/assets/js/51.fca7ece9.js"><link rel="prefetch" href="/assets/js/52.dfd2418a.js"><link rel="prefetch" href="/assets/js/53.0547a2da.js"><link rel="prefetch" href="/assets/js/54.77c456cb.js"><link rel="prefetch" href="/assets/js/55.2ea7947c.js"><link rel="prefetch" href="/assets/js/56.93aa6440.js"><link rel="prefetch" href="/assets/js/57.e1c7aaa6.js"><link rel="prefetch" href="/assets/js/58.5368de52.js"><link rel="prefetch" href="/assets/js/59.fb2e12ff.js"><link rel="prefetch" href="/assets/js/6.fe5e508e.js"><link rel="prefetch" href="/assets/js/60.b8e6a986.js"><link rel="prefetch" href="/assets/js/61.fe69b359.js"><link rel="prefetch" href="/assets/js/62.74e87082.js"><link rel="prefetch" href="/assets/js/63.75ce37b4.js"><link rel="prefetch" href="/assets/js/64.3b4f72ef.js"><link rel="prefetch" href="/assets/js/65.3f53a9a4.js"><link rel="prefetch" href="/assets/js/66.8403887b.js"><link rel="prefetch" href="/assets/js/67.a2a1488d.js"><link rel="prefetch" href="/assets/js/68.f1c01bf8.js"><link rel="prefetch" href="/assets/js/69.ef3591d4.js"><link rel="prefetch" href="/assets/js/7.a65affc1.js"><link rel="prefetch" href="/assets/js/70.df41328b.js"><link rel="prefetch" href="/assets/js/71.d8cd75fb.js"><link rel="prefetch" href="/assets/js/72.e781e7e1.js"><link rel="prefetch" href="/assets/js/73.aaf45776.js"><link rel="prefetch" href="/assets/js/74.2a35588a.js"><link rel="prefetch" href="/assets/js/75.e8adcf85.js"><link rel="prefetch" href="/assets/js/76.16da36dd.js"><link rel="prefetch" href="/assets/js/77.201f553d.js"><link rel="prefetch" href="/assets/js/78.bb374675.js"><link rel="prefetch" href="/assets/js/79.7b92c1ff.js"><link rel="prefetch" href="/assets/js/8.08fdf9a5.js"><link rel="prefetch" href="/assets/js/80.273f2594.js"><link rel="prefetch" href="/assets/js/81.4fbbe071.js"><link rel="prefetch" href="/assets/js/82.4d39e160.js"><link rel="prefetch" href="/assets/js/83.24e0a19d.js"><link rel="prefetch" href="/assets/js/84.0c030198.js"><link rel="prefetch" href="/assets/js/85.00fc1248.js"><link rel="prefetch" href="/assets/js/86.7bd1bf53.js"><link rel="prefetch" href="/assets/js/87.5b28d027.js"><link rel="prefetch" href="/assets/js/88.8c5037f4.js"><link rel="prefetch" href="/assets/js/89.a06dc5bd.js"><link rel="prefetch" href="/assets/js/90.2df5d8ba.js"><link rel="prefetch" href="/assets/js/91.c3326db3.js"><link rel="prefetch" href="/assets/js/92.57931d85.js"><link rel="prefetch" href="/assets/js/93.bcda9957.js"><link rel="prefetch" href="/assets/js/94.43d71792.js"><link rel="prefetch" href="/assets/js/95.65bbe7b0.js"><link rel="prefetch" href="/assets/js/96.4d8b933c.js"><link rel="prefetch" href="/assets/js/97.9ef35d1d.js"><link rel="prefetch" href="/assets/js/98.94a4172c.js"><link rel="prefetch" href="/assets/js/99.9db6ba1a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6aa5acdd.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/index/book.png" alt="Haoyuan's blog" class="logo"> <span class="site-name can-hide">Haoyuan's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/navigation/" class="nav-link">导航站</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/se/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/java/collection/" class="nav-link">Java集合</a></li><li class="dropdown-subitem"><a href="/java/se/reflect/" class="nav-link">Java反射</a></li><li class="dropdown-subitem"><a href="/java/juc/" class="nav-link">JavaJUC</a></li><li class="dropdown-subitem"><a href="/java/jvm/" class="nav-link">JavaJVM</a></li></ul></li><li class="dropdown-item"><h4>Java容器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/javaweb/concept/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Java版本新特性</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/new-features/" class="nav-link">Java新特性</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/oracle/" class="nav-link">Oracle</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/es/" class="nav-link">ElasticSearch</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/frames/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mybatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/mybatis-plus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>消息中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/activemq/" class="nav-link">ActiveMQ</a></li><li class="dropdown-subitem"><a href="/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/rocketmq/" class="nav-link">RocketMQ</a></li><li class="dropdown-subitem"><a href="/kafka/" class="nav-link">Kafka</a></li></ul></li><li class="dropdown-item"><h4>进阶服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nginx/" class="nav-link router-link-active">Nginx</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring生态" class="dropdown-title"><a href="/spring-ecology/" class="link-title">Spring生态</a> <span class="title" style="display:none;">Spring生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/spring-boot/" class="nav-link">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/spring-security/" class="nav-link">Spring Security</a></li><li class="dropdown-item"><!----> <a href="/spring-cloud/" class="nav-link">Spring Cloud</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/dev-guide/" class="link-title">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design-pattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/knowledge/" class="nav-link">知识</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tool/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/maven/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/git/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/docker/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/jenkins/" class="nav-link">Jenkins</a></li><li class="dropdown-subitem"><a href="/kubernetes/" class="nav-link">Kubernetes</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/typescript/" class="nav-link">TypeScript</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/vue2/" class="nav-link">Vue2</a></li><li class="dropdown-subitem"><a href="/vue3/" class="nav-link">Vue3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whells-use/" class="nav-link">轮子工具</a></li><li class="dropdown-item"><!----> <a href="/projects/" class="nav-link">项目工程</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whell/web/" class="nav-link">收藏</a></li><li class="dropdown-subitem"><a href="/about/mdskill/" class="nav-link">关于</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/message-area/" class="nav-link">留言区</a></div> <a href="https://github.com/Somnus711/Somnus711.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/Somnus711/picx-image-hosting@master/blog-pic/avatar.2b7e13idyy9s.webp"> <div class="blogger-info"><h3>Somnus Haoyuan</h3> <span>Word is cheap, show me the code.</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/navigation/" class="nav-link">导航站</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/se/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/java/collection/" class="nav-link">Java集合</a></li><li class="dropdown-subitem"><a href="/java/se/reflect/" class="nav-link">Java反射</a></li><li class="dropdown-subitem"><a href="/java/juc/" class="nav-link">JavaJUC</a></li><li class="dropdown-subitem"><a href="/java/jvm/" class="nav-link">JavaJVM</a></li></ul></li><li class="dropdown-item"><h4>Java容器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/javaweb/concept/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Java版本新特性</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/new-features/" class="nav-link">Java新特性</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/oracle/" class="nav-link">Oracle</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/es/" class="nav-link">ElasticSearch</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/frames/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mybatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/mybatis-plus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>消息中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/activemq/" class="nav-link">ActiveMQ</a></li><li class="dropdown-subitem"><a href="/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/rocketmq/" class="nav-link">RocketMQ</a></li><li class="dropdown-subitem"><a href="/kafka/" class="nav-link">Kafka</a></li></ul></li><li class="dropdown-item"><h4>进阶服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nginx/" class="nav-link router-link-active">Nginx</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring生态" class="dropdown-title"><a href="/spring-ecology/" class="link-title">Spring生态</a> <span class="title" style="display:none;">Spring生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/spring-boot/" class="nav-link">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/spring-security/" class="nav-link">Spring Security</a></li><li class="dropdown-item"><!----> <a href="/spring-cloud/" class="nav-link">Spring Cloud</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/dev-guide/" class="link-title">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design-pattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/knowledge/" class="nav-link">知识</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tool/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/maven/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/git/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/docker/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/jenkins/" class="nav-link">Jenkins</a></li><li class="dropdown-subitem"><a href="/kubernetes/" class="nav-link">Kubernetes</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/typescript/" class="nav-link">TypeScript</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/vue2/" class="nav-link">Vue2</a></li><li class="dropdown-subitem"><a href="/vue3/" class="nav-link">Vue3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whells-use/" class="nav-link">轮子工具</a></li><li class="dropdown-item"><!----> <a href="/projects/" class="nav-link">项目工程</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whell/web/" class="nav-link">收藏</a></li><li class="dropdown-subitem"><a href="/about/mdskill/" class="nav-link">关于</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/message-area/" class="nav-link">留言区</a></div> <a href="https://github.com/Somnus711/Somnus711.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis-Plus</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件 - ActiveMQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件 - RabbitMQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件 - RocketMQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件 - Kafka</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>高性能服务器 - Nginx</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nginx/introduce/" class="sidebar-link">Nginx - 介绍</a></li><li><a href="/nginx/install/" class="sidebar-link">Nginx - 环境准备</a></li><li><a href="/niginx/commands/" class="sidebar-link">Nginx - 基础指令</a></li><li><a href="/nginx/config/" class="sidebar-link">Nginx - 核心配置文件</a></li><li><a href="/nginx/example/" class="sidebar-link">Nginx - 配置巩固实例</a></li><li><a href="/nginx/static-doploy/" class="sidebar-link">Nginx - 静态资源部署</a></li><li><a href="/nginx/static-visit/" class="sidebar-link">Nginx - 静态资源访问</a></li><li><a href="/nginx/reverse-proxy/" class="sidebar-link">Nginx - 反向代理</a></li><li><a href="/nginx/load-balancing/" class="sidebar-link">Nginx - 负载均衡</a></li><li><a href="/nginx/cache-integration/" class="sidebar-link">Nginx - 缓存集成</a></li><li><a href="/nginx/deploy-cluster/" aria-current="page" class="active sidebar-link">Nginx - 部署与集群</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/nginx/deploy-cluster/#nginx与tomcat部署" class="sidebar-link">Nginx与Tomcat部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#环境准备-tomcat" class="sidebar-link">环境准备(Tomcat)</a></li><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#环境准备-nginx" class="sidebar-link">环境准备(Nginx)</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/nginx/deploy-cluster/#动静分离" class="sidebar-link">动静分离</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#需求分析" class="sidebar-link">需求分析</a></li><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#实现步骤" class="sidebar-link">实现步骤</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/nginx/deploy-cluster/#tomcat集群搭建" class="sidebar-link">Tomcat集群搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#环境搭建" class="sidebar-link">环境搭建</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/nginx/deploy-cluster/#nginx集群搭建" class="sidebar-link">Nginx集群搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#keepalived" class="sidebar-link">Keepalived</a></li><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#vrrp介绍" class="sidebar-link">VRRP介绍</a></li><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#环境搭建-2" class="sidebar-link">环境搭建</a></li><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#keepalived配置文件介绍" class="sidebar-link">Keepalived配置文件介绍</a></li><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#vrrp-instance" class="sidebar-link">vrrp_instance</a></li><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#服务器配置" class="sidebar-link">服务器配置</a></li><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#访问测试" class="sidebar-link">访问测试</a></li><li class="sidebar-sub-header level3"><a href="/nginx/deploy-cluster/#vrrp-script" class="sidebar-link">vrrp_script</a></li></ul></li></ul></li><li><a href="/nginx/site-auth/" class="sidebar-link">Nginx - 站点与认证</a></li><li><a href="/nginx/lau/" class="sidebar-link">Nginx - Lau学习</a></li><li><a href="/nginx/modules/" class="sidebar-link">Nginx - Lua扩展模块</a></li><li><a href="/nginx/ngx-lua-table/" class="sidebar-link">Nginx - Lua模块文档表</a></li><li><a href="/nginx/images/" class="sidebar-link">Nginx - 自定义镜像</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>响应式框架 - Reactor</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E6%A1%86%E6%9E%B6" title="分类" data-v-06225672>框架</a></li><li data-v-06225672><a href="/categories/?category=%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%20-%20Nginx" title="分类" data-v-06225672>高性能服务器 - Nginx</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://www.denghaoyuan.com/" target="_blank" title="作者" class="beLink" data-v-06225672>Haoyuan</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2021-11-29</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Nginx - 部署与集群<!----></h1> <!----> <div class="theme-vdoing-content content__default"><div class="custom-block note"><p class="custom-block-title">笔记</p> <p>Nginx 接收用户的请求后如何把请求转发到后台 Web 服务器？Nginx 如何实现动静分离？Nginx 又如何实现集群搭建，本内容将带大家学习 Nginx 的部署与集群知识。</p> <div class="custom-block right"><p>2021-11-29 @Young Kbt</p></div></div> <p></p><div class="table-of-contents"><ul><li><a href="#nginx与tomcat部署">Nginx与Tomcat部署</a><ul><li><a href="#环境准备-tomcat">环境准备(Tomcat)</a></li><li><a href="#环境准备-nginx">环境准备(Nginx)</a></li></ul></li><li><a href="#动静分离">动静分离</a><ul><li><a href="#需求分析">需求分析</a></li><li><a href="#实现步骤">实现步骤</a></li></ul></li><li><a href="#tomcat集群搭建">Tomcat集群搭建</a><ul><li><a href="#环境搭建">环境搭建</a></li></ul></li><li><a href="#nginx集群搭建">Nginx集群搭建</a><ul><li><a href="#keepalived">Keepalived</a></li><li><a href="#vrrp介绍">VRRP介绍</a></li><li><a href="#环境搭建">环境搭建</a></li><li><a href="#keepalived配置文件介绍">Keepalived配置文件介绍</a></li><li><a href="#vrrp-instance">vrrp_instance</a></li><li><a href="#服务器配置">服务器配置</a></li><li><a href="#访问测试">访问测试</a></li><li><a href="#vrrp-script">vrrp_script</a></li></ul></li></ul></div><p></p> <h2 id="nginx与tomcat部署"><a href="#nginx与tomcat部署" class="header-anchor">#</a> Nginx与Tomcat部署</h2> <p>前面已经将 Nginx 的大部分内容进行了讲解，我们都知道了 Nginx 在高并发场景和处理静态资源是非常高性能的，但是在实际项目中除了静态资源还有就是后台业务代码模块，一般后台业务都会被部署在 Tomcat、weblogic 或者是 websphere 等 Web 服务器上。那么如何使用 Nginx 接收用户的请求并把请求转发到后台 Web 服务器？</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211130172629.png" alt="1604498725652"></p> <p>步骤分析:</p> <ul><li>在服务器 A 上准备 Tomcat 环境，并在 Tomcat 上部署一个 Web 项目。这步骤在 <a href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-tomcat">环境准备(Tomcat)</a></li> <li>在服务器 B 上准备 Nginx 环境，使用 Nginx 接收请求，并把请求分发到 Tomcat 上。这步骤在 <a href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-nginx">环境准备(Nginx)</a></li></ul> <h3 id="环境准备-tomcat"><a href="#环境准备-tomcat" class="header-anchor">#</a> 环境准备(Tomcat)</h3> <p>本次将采用 Tomcat 作为后台 Web 服务器。</p> <ul><li><p>在 服务器 A 上准备一个 Tomcat</p> <ul><li>Tomcat 官网地址：<a href="https://tomcat.apache.org/" target="_blank" rel="noopener noreferrer">https://tomcat.apache.org/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><p>下载 Tomcat，这里使用的是 <code>apache-tomcat-9.0.54.tar.gz</code></p></li> <li><p>进入上传目录，将 Tomcat 进行解压缩</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">mkdir</span> /usr/local/tomcat

<span class="token function">tar</span> <span class="token parameter variable">-zxf</span> apache-tomcat-9.0.54.tar.gz <span class="token parameter variable">-C</span> /usr/local/tomcat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>准备一个 Web 项目，将其打包为 War 包，这里是 demo.war</p> <ul><li><p>将写好的 War 包上传到 Tomcat 目录下的 webapps 包下</p></li> <li><p>将 Tomcat 进行启动，进入 Tomcat 的 bin 目录下，执行命令：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./startup.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p>启动完成 Tomcat 后，进行访问测试</p> <p>浏览器访问：</p> <ul><li><p>静态资源：<code>http://192.168.200.146:8080/demo/index.html</code></p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129123846.png" alt="image-20211129123837835"></p></li> <li><p>动态资源：<code>http://192.168.200.146:8080/demo/getAddress</code></p> <p>动态资源可以是端口号，此时的端口是 8080</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129124819.png" alt="image-20211129124753971"></p></li></ul></li></ul> <p>自此，服务器 A 的 Tomcat 部署已经实现。</p> <p><strong>demo.war 的内容有什么呢？</strong></p> <p>其实你可以自己制作一个 war 包，这里说明一下，demo.war 里有两个图片，和一个 index.html</p> <p>index.html 文件引用了两个图片：</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>js/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://192.168.200.133/demo/getAddress'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
               <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>images/logo.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Nginx如何将请求转发到后端服务器<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>images/mv.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>可以看出，当访问 index.html 时，它会主动去请求 <code>/getAddress</code>，这个请求返回端口号，即把 8080 当作动态资源，显示到页面上，如果是 9090 端口访问，则返回 9090 显示页面上。你也可以直接访问 <code>/getAddress</code>，直接获取端口号。</p> <h3 id="环境准备-nginx"><a href="#环境准备-nginx" class="header-anchor">#</a> 环境准备(Nginx)</h3> <p>我们已经在 Tomcat 实现了两个效果，那么现在需要把 Tomcat 的地址放到 Nginx 里，由 Nginx 帮我们代理这个 Tomcat 地址，这样我们访问 Nginx，实际上就是访问 Tomcat。</p> <p>（1）使用 Nginx 的反向代理，将请求转给 Tomcat 进行处理。</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> webservice</span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">server</span> 192.168.200.146:8080</span><span class="token punctuation">;</span>  <span class="token comment"># 服务器 A 的 Tomcat  地址</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>		<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /demo</span> <span class="token punctuation">{</span>
    	<span class="token directive"><span class="token keyword">proxy_pass</span> http://webservice</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>（2）启动访问服务器 B，测试是否代理到服务器 A 的 Tomcat，效果如图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129124916.png" alt="1604421312486"></p> <p>学习到这，可能大家会有一个困惑，明明直接通过 Tomcat 就能访问，为什么还需要多加一个 Nginx，这样不是反而是系统的复杂度变高了么?
那接下来我们从两个方便给大家分析下这个问题，</p> <ul><li><p>第一个使用 Nginx 实现动静分离</p></li> <li><p>第二个使用 Nginx 搭建 Tomcat 的集群</p></li></ul> <h2 id="动静分离"><a href="#动静分离" class="header-anchor">#</a> 动静分离</h2> <p><strong>什么是动静分离？</strong></p> <ul><li>动：后台应用程序的业务处理</li> <li>静：网站的静态资源（html，javaScript，css，images 等文件）</li> <li>分离：将两者进行分开部署访问，提供用户进行访问。</li></ul> <p><strong>举例说明就是以后所有和静态资源相关的内容都交给 Nginx 来部署访问，非静态内容则交个类似于 Tomcat 的服务器来部署访问。</strong></p> <p><strong>为什么要动静分离？</strong></p> <p>前面我们介绍过 Nginx 在处理静态资源的时候，效率是非常高的，而且 Nginx 的并发访问量也是名列前茅，而 Tomcat 则相对比较弱一些，所以把静态资源交给 Nginx 后，可以减轻 Tomcat 服务器的访问压力并提高静态资源的访问速度。</p> <p>动静分离以后，降低了动态资源和静态资源的耦合度。如动态资源宕机了也不影响静态资源的展示。</p> <p><strong>如何实现动静分离?</strong></p> <p>实现动静分离的方式很多，比如静态资源可以部署到 CDN、Nginx 等服务器上，动态资源可以部署到 Tomcat、weblogic 或者 websphere 上。这里使用 Nginx + Tomcat 来实现动静分离。</p> <h3 id="需求分析"><a href="#需求分析" class="header-anchor">#</a> 需求分析</h3> <p>如下图，因为 Nginx 处理静态资源性能高，所以我们把静态资源放在 Nginx 服务器上，然后把动态资源放到 Tomcat 服务器上。当访问 Nginx 的静态资源时，Nginx 会去访问 Tocmat 获取动态资源。实现动静分离。</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129150518.png" alt="1604422564855"></p> <h3 id="实现步骤"><a href="#实现步骤" class="header-anchor">#</a> 实现步骤</h3> <ul><li><p>将 demo.war 项目中的静态资源（两个图片）都删除掉，重新打包生成一个 War 包</p> <p>这时候 War 包只留下动态资源，而静态资源要放到 Nginx 上。</p></li> <li><p>将新的 War 包部署到 Tomcat 中，把之前部署的内容删除掉</p> <ul><li><p>进入到 tomcat 的 webapps 目录下，将之前的 demo 目录和 demo.war 包删除掉</p></li> <li><p>将新的 War 包复制到 webapps 下</p></li> <li><p>将 tomcat 启动</p></li></ul></li> <li><p>在 Nginx 所在的服务器 B 上创建如下目录，并将对应的静态资源放入指定的位置</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129151615.png" alt="1604493947499"></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">mkdir</span> /usr/local/nginx/html/web/images
<span class="token function">mkdir</span> /usr/local/nginx/html/web/js

<span class="token function">cp</span> logo.png /usr/local/nginx/html/web/images
<span class="token function">cp</span> mv.png /usr/local/nginx/html/web/images
<span class="token function">cp</span> jquery.min.js /usr/local/nginx/html/web/js

<span class="token function">vim</span> /usr/local/nginx/html/web/index.html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>其中 index.html 页面的内容如下:</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>js/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://192.168.200.133/demo/getAddress'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
               <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>images/logo.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Nginx如何将请求转发到后端服务器<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>images/mv.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>第 9 行代码，它访问的这个地址是服务器 B 的 Nginx，通过这个地址让 Nginx 去获取服务器 A 的 Tomcat 动态资源。</p></li> <li><p>在配置文件配置 Nginx 的静态资源与动态资源的访问</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> webservice</span><span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.200.146:8080</span><span class="token punctuation">;</span>  <span class="token comment"># 服务器 A 的 Tocmat</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>

    <span class="token comment"># 动态资源从 Tomcat 获取</span>
    <span class="token directive"><span class="token keyword">location</span> /demo</span> <span class="token punctuation">{</span>     		 <span class="token comment"># index.html 第 9 行代码触发该 location</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://webservice</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 静态资源从自己身上获取</span>
    <span class="token directive"><span class="token keyword">location</span> ~/.*\.(png|jpg|gif|js)</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> html/web</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span>   html/web</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li><p>启动测试，访问 <code>http://192.168.200.133</code></p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129150848.png" alt="1604494128097"></p> <p>假如某个时间点，由于某个原因导致 Tomcat 后的服务器宕机了，我们再次访问 Nginx，会得到如下效果：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129152116.png" alt="1604494156197"></p> <p>用户还是能看到页面，只是缺失 Tomcat 的动态资源，这就是前后端耦合度降低的效果，并且整个请求只和后的服务器交互了一次，js 和 images 都直接从 Nginx 服务器里返回，提供了效率，降低了后端服务器的压力。</p></li></ul> <h2 id="tomcat集群搭建"><a href="#tomcat集群搭建" class="header-anchor">#</a> Tomcat集群搭建</h2> <p>在使用 Nginx 和 Tomcat 部署项目的时候，我们使用的是一台 Nginx 服务器和一台 Tomcat 服务器，效果图如下：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129152253.png" alt="1604494256017"></p> <p>那么问题来了，如果 Tomcat 的真的宕机了，整个系统就会不完整，所以如何解决上述问题？</p> <p>一台服务器容易宕机，那就多搭建几台 Tomcat 服务器，这样的话就提升了后的服务器的可用性。这也就是我们常说的集群，搭建 Tomcat 的集群需要用到了 Nginx 的反向代理和赋值均衡的知识，具体如何来实现？</p> <p>我们先来分析下原理：</p> <p>用户请求到 Nginx，Nginx 使用负载均衡对三个 Tomcat 服务器进行访问，如果一个 Tomcat 服务器宕机了，那么还有两个 Tomcat 服务器可以使用。</p> <p>如图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129152549.png" alt="1604494269848"></p> <h3 id="环境搭建"><a href="#环境搭建" class="header-anchor">#</a> 环境搭建</h3> <p>（1）准备 3 台 Tomcat 服务器，使用端口进行区分（实际环境应该是三台服务器），修改 Tomcat 的 server.xml，将端口修改分别修改为 8080、8180、8280</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">cp</span> <span class="token parameter variable">-r</span> apache-tomcat-9.0.54 tomcat01
<span class="token function">cp</span> <span class="token parameter variable">-r</span> apache-tomcat-9.0.54 tomcat02
<span class="token function">cp</span> <span class="token parameter variable">-r</span> apache-tomcat-9.0.54 tomcat03
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>修改三个 Tocmat 配置文件的端口</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> tomcat01/conf/server.xml
<span class="token function">vim</span> tomcat02/conf/server.xml
<span class="token function">vim</span> tomcat03/conf/server.xml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>修改的内容位置如下：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129153013.png" alt="image-20211129153012231"></p> <p>（2）启动 Tomcat 并访问测试，</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//192.168.200.146:8080/demo/getAddress</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129153044.png" alt="1604494822961"></p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//192.168.200.146:8180/demo/getAddress</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129153046.png" alt="1604494843886"></p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//192.168.200.146:8280/demo/getAddress</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129153048.png" alt="1604494860954"></p> <p>(3)在 Nginx 对应的配置文件中添加如下内容:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> webservice</span><span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.200.146:8080</span><span class="token punctuation">;</span>     <span class="token comment"># tomcat01</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.200.146:8180</span><span class="token punctuation">;</span> 	 <span class="token comment"># tomcat02</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.200.146:8280</span><span class="token punctuation">;</span>	 <span class="token comment"># tomcat03</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>		<span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /demo</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://webservice</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>好了，完成了上述环境的部署，我们已经解决了 Tomcat 的高可用性，一台服务器宕机，还有其他两条对外提供服务，同时也可以实现后台服务器的不间断更新。</p> <p><strong>但是新问题出现了，上述环境中，如果是 Nginx 宕机了呢，那么整套系统都将服务对外提供服务了，这个如何解决？</strong></p> <h2 id="nginx集群搭建"><a href="#nginx集群搭建" class="header-anchor">#</a> Nginx集群搭建</h2> <p>针对于上面提到的问题，我们来分析下要想解决上述问题，需要面临哪些问题？</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129153455.png" alt="1604495169905"></p> <p>需要两台以上的 Nginx 服务器对外提供服务，这样的话就可以解决其中一台宕机了，另外一台还能对外提供服务，但是如果是两台 Nginx 服务器的话，会有两个 IP 地址，用户该访问哪台服务器，用户怎么知道哪台是好的，哪台是宕机了的？</p> <h3 id="keepalived"><a href="#keepalived" class="header-anchor">#</a> Keepalived</h3> <p>使用 Keepalived 来解决，Keepalived 软件由 C 编写的，最初是专为 LVS 负载均衡软件设计的，Keepalived 软件主要是通过 VRRP 协议实现高可用功能。</p> <h3 id="vrrp介绍"><a href="#vrrp介绍" class="header-anchor">#</a> VRRP介绍</h3> <p>VRRP（Virtual Route Redundancy Protocol）协议，翻译过来为虚拟路由冗余协议。VRRP 协议将两台或多台路由器设备虚拟成一个设备，对外提供虚拟路由器 IP，而在路由器组内部，如果实际拥有这个对外 IP 的路由器如果工作正常的话就是 MASTER，MASTER 实现针对虚拟路由器IP的各种网络功能。其他设备不拥有该虚拟 IP，状态为 BACKUP，处了接收 MASTER 的 VRRP 状态通告信息以外，不执行对外的网络功能。当主机失效时，BACKUP 将接管原先 MASTER 的网络功能。</p> <p>看图分析：VRRP 把两个 Nginx 分成两个路由（VRRP 路由 1 和 VRRP 路由 2），并生成一个 Virtual 路由，用户访问的是 Virtual 路由，该路由会去访问两个 Nginx 生成的 VRRP 路由。那么到底访问谁呢？VRRP 会给两个路由分配角色，一个是 Master（老大），另一个是 Backup（备份），所以访问的是 Master 角色的路由，当 Master 角色路由宕机了，才会找到 Backup 备份路由。</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129153516.png" alt="1604495824757"></p> <p>从上面的介绍信息获取到的内容就是 VRRP 是一种协议，那这个协议是用来干什么的？</p> <ol><li><p>选择协议</p> <p>VRRP 可以把一个虚拟路由器的责任动态分配到局域网上的 VRRP 路由器中的一台。其中的虚拟路由即 Virtual 路由是由 VRRP 路由群组创建的一个不真实存在的路由，这个虚拟路由也是有对应的 IP 地址。而且 VRRP 路由 1 和 VRRP 路由 2 之间会有竞争选择，通过选择会产生一个 Master 路由和一个 Backup 路由。</p></li> <li><p>路由容错协议</p> <p>Master 路由和 Backup 路由之间会有一个心跳检测，Master 会定时告知 Backup 自己的状态，如果在指定的时间内，Backup 没有接收到这个通知内容，Backup 就会替代 Master 成为新的 Master。Master 路由有一个特权就是虚拟路由和后端服务器都是通过 Master 进行数据传递交互的，而备份节点则会直接丢弃这些请求和数据，不做处理，只是去监听 Master 的状态。</p></li></ol> <p>用了 Keepalived 后，解决方案如图下:</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129153526.png" alt="1604495442179"></p> <p>看图分析：VIP 是虚拟路由，是专门给用户发送请求。一旦用户发送请求到 VIP，VIP 就会发送给 Master（主）的 Nginx，如果 Master（主）Nginx 宕机了，才会发送给 Backup（备份） Nginx 路由。</p> <h3 id="环境搭建-2"><a href="#环境搭建-2" class="header-anchor">#</a> 环境搭建</h3> <p>环境准备</p> <table><thead><tr><th>VIP IP</th> <th>Nginx IP</th> <th>主机名</th> <th>主/从</th></tr></thead> <tbody><tr><td></td> <td>192.168.200.133（服务器 A）</td> <td>keepalived1</td> <td>Master</td></tr> <tr><td>192.168.200.222</td> <td></td> <td></td> <td></td></tr> <tr><td></td> <td>192.168.200.122（服务器 B）</td> <td>keepalived2</td> <td>Backup</td></tr></tbody></table> <p><strong>确保服务器 A 和服务器 B 的 Nginx 配置保持一致。</strong></p> <p>keepalived 的安装步骤如下：</p> <ul><li><p>步骤1：从官方网站下载 keepalived，官网地址 <a href="https://keepalived.org/" target="_blank" rel="noopener noreferrer">https://keepalived.org/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>步骤2：将下载的资源上传到服务器，这里是 <code>keepalived-2.0.20.tar.gz</code></p></li> <li><p>步骤3：在 <code>/opt</code> 目录下创建 keepalived 目录，方便管理资源</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">mkdir</span> /opt/keepalived
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>步骤4：将压缩文件进行解压缩，解压缩到指定的目录</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">tar</span> <span class="token parameter variable">-zxf</span> keepalived-2.0.20.tar.gz <span class="token parameter variable">-C</span> /opt/keepalived
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>步骤5：对 keepalived 进行配置，编译和安装</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /opt/keepalived/keepalived-2.0.20

./configure <span class="token parameter variable">--sysconf</span><span class="token operator">=</span>/etc <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local   <span class="token comment"># 安装到 /usr/local 目录下，可修改</span>

<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <p><strong>两台 Nginx 服务器都要安装 keepalive。</strong></p> <p>安装完成后，有两个文件需要我们认识下：</p> <ul><li><p><code>/etc/keepalived/keepalived.conf</code>：keepalived 的系统配置文件，我们主要操作的就是该文件</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129155700.png" alt="image-20211129155635556"></p></li> <li><p><code>/usr/local/sbin</code> 目录下的 <code>keepalived</code>：这是系统配置脚本，用来启动和关闭 keepalived</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129155657.png" alt="image-20211129155656699"></p></li></ul> <h3 id="keepalived配置文件介绍"><a href="#keepalived配置文件介绍" class="header-anchor">#</a> Keepalived配置文件介绍</h3> <p>打开 keepalived.conf 配置文件</p> <p>这里面会分三部：</p> <ul><li><p>第一部分是 global 全局配置</p></li> <li><p>第二部分是 vrrp 相关配置</p></li> <li><p>第三部分是 LVS 相关配置。</p></li></ul> <p>这里主要是使用 keepalived 实现高可用部署，没有用到 LVS，所以我们重点关注的是前两部分。</p> <p>打开 keepalived.conf 文件</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /etc/keepalived/keepalived.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>文件内容部分介绍如下：</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment"># global全局部分</span>
<span class="token directive"><span class="token keyword">global_defs</span></span> <span class="token punctuation">{</span>
    
   <span class="token directive"><span class="token keyword">notification_email</span></span> <span class="token punctuation">{</span>  <span class="token comment"># 通知邮件，当 keepalived 切换 Master 和 Backup 时需要发 email 给具体的邮箱地址</span>
     tom@itcast.cn
     jerry@itcast.cn
   <span class="token punctuation">}</span>
   notification_email_from kele@youngkbt.com   <span class="token comment"># 设置发件人的邮箱信息</span>
   
   smtp_server 192.168.200.1   <span class="token comment"># 指定 smpt 服务地址</span>
   
   smtp_connect_timeout 30   <span class="token comment"># 指定 smpt 服务连接超时时间</span>
   
   router_id LVS_DEVEL   <span class="token comment"># 运行 keepalived 服务器的一个标识，可以用作发送邮件的主题信息</span>
   
   <span class="token comment"># 默认是不跳过检查。检查收到的 VRRP 通告中的所有地址可能会比较耗时，设置此命令的意思是，如果通告与接收的上一个通告来自相同的 master 路由器，则不执行检查(跳过检查)</span>
   vrrp_skip_check_adv_addr
   
   vrrp_strict    <span class="token comment"># 严格遵守 VRRP 协议</span>
  
   vrrp_garp_interval 0   <span class="token comment"># 在一个接口发送的两个免费 ARP 之间的延迟。可以精确到毫秒级。默认是 0</span>
   
   vrrp_gna_interval 0  <span class="token comment"># 在一个网卡上每组消息之间的延迟时间，默认为 0</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>这里需要修改的是 5、6、8 行代码。</p> <p>VRRP 部分可以包含以下四个子模块：</p> <ol><li><p>vrrp_script</p></li> <li><p>vrrp_sync_group</p></li> <li><p>garp_group</p></li> <li><p>vrrp_instance</p></li></ol> <p>我们会用到第一个（<a href="#vrrp-script">vrrp_script</a>）和第四个（<a href="#vrrp-instance">vrrp_instance</a>）。</p> <h3 id="vrrp-instance"><a href="#vrrp-instance" class="header-anchor">#</a> vrrp_instance</h3> <p><code>vrrp_instance</code> 模块内容：</p> <div class="language-nginx line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-nginx"><code><span class="token comment"># 设置 keepalived 实例的相关信息，VI_1 为 VRRP 实例名称</span>
<span class="token directive"><span class="token keyword">vrrp_instance</span> VI_1</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">state</span> MASTER  		  <span class="token comment"># 有两个值可选 MASTER 主，BACKUP 备</span>
    interface ens33		  <span class="token comment"># vrrp 实例绑定的接口，用于发送 VRRP 包[当前服务器使用的网卡名称]</span>
    virtual_router_id <span class="token number">51</span>  <span class="token comment"># 指定 VRRP 实例 ID，范围是 0-255</span>
    priority <span class="token number">100</span>		  <span class="token comment"># 指定优先级，优先级高的将成为 MASTER</span>
    advert_int <span class="token number">1</span>		  <span class="token comment"># 指定发送 VRRP 通告的间隔，单位是秒。这里是心跳检查的时间</span>
    authentication</span> <span class="token punctuation">{</span>	  <span class="token comment"># vrrp 之间通信的认证信息</span>
        auth_type PASS	  <span class="token comment"># 指定认证方式。PASS 简单密码认证(推荐)</span>
        auth_pass 1111	  <span class="token comment"># 指定认证使用的密码，最多 8 位</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">virtual_ipaddress</span></span> <span class="token punctuation">{</span>   <span class="token comment"># 虚拟 IP 地址设置虚拟 IP 地址，供用户访问使用，可设置多个，一行一个</span>
        192.168.200.222
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>vrrp_instance</code> 模块中我们修改的是第 3、5、6、7、13 行代码。</p> <p>第 3 行代码是说明当前 Nginx 服务器的角色是 Master 还是 Backup。分别在服务器 A 和 B 进行角色配置。</p> <p>第 5 行代码是 VIP 的 ID，如果使用相同的虚拟路由 VIP，请保持 ID 一致。</p> <p>第 6 行代码是优先级，请让 Master 服务器的优先级大于 Backup 服务器的优先级。如 100 &gt; 90。</p> <p>第 7 行代码是 Master 和 Backup 之间通信的间隔时间，如果无法通信，说明 Master 已经宕机，则切换为 Backup。</p> <p>第 13 行代码是用户访问的虚拟 IP 地址，即 VIP，它会发送给 Nginx 服务器。</p> <h3 id="服务器配置"><a href="#服务器配置" class="header-anchor">#</a> 服务器配置</h3> <p>Keepalived 的具体配置内容如下：</p> <div class="theme-code-group" data-v-2f5f1757><div class="theme-code-group__nav" data-v-2f5f1757><ul class="theme-code-group__ul" data-v-2f5f1757></ul></div> <div class="theme-code-block theme-code-block__active" data-v-4f1e9d0c><div class="language-nginx line-numbers-mode" data-v-4f1e9d0c><pre class="language-nginx" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token directive" data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>global_defs</span></span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
   <span class="token directive" data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>notification_email</span></span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        tom@itcast.cn
        jerry@itcast.cn
   <span class="token punctuation" data-v-4f1e9d0c>}</span>
   notification_email_from zhaomin@itcast.cn
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id keepalived1
   vrrp_skip_check_adv_addr
   vrrp_strict
   vrrp_garp_interval 0
   vrrp_gna_interval 0
<span class="token punctuation" data-v-4f1e9d0c>}</span>

<span class="token directive" data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>vrrp_instance</span> VI_1</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    <span class="token directive" data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>state</span> MASTER
    interface ens33
    virtual_router_id <span class="token number" data-v-4f1e9d0c>51</span>
    priority <span class="token number" data-v-4f1e9d0c>100</span>
    advert_int <span class="token number" data-v-4f1e9d0c>1</span>
    authentication</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        auth_type PASS
        auth_pass 1111
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token directive" data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>virtual_ipaddress</span></span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        192.168.200.222
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-nginx line-numbers-mode" data-v-4f1e9d0c><pre class="language-nginx" data-v-4f1e9d0c><code data-v-4f1e9d0c>! <span class="token directive" data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>Configuration</span> File for keepalived

global_defs</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
   <span class="token directive" data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>notification_email</span></span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        tom@itcast.cn
        jerry@itcast.cn
   <span class="token punctuation" data-v-4f1e9d0c>}</span>
   notification_email_from zhaomin@itcast.cn
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id keepalived2
   vrrp_skip_check_adv_addr
   vrrp_strict
   vrrp_garp_interval 0
   vrrp_gna_interval 0
<span class="token punctuation" data-v-4f1e9d0c>}</span>

<span class="token directive" data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>vrrp_instance</span> VI_1</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    <span class="token directive" data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>state</span> BACKUP
    interface ens33
    virtual_router_id <span class="token number" data-v-4f1e9d0c>51</span>
    priority <span class="token number" data-v-4f1e9d0c>90</span>
    advert_int <span class="token number" data-v-4f1e9d0c>1</span>
    authentication</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        auth_type PASS
        auth_pass 1111
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token directive" data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>virtual_ipaddress</span></span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        192.168.200.222
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c></div></div></div> <pre class="pre-blank" data-v-2f5f1757>// Make sure to add code blocks to your code group</pre></div> <h3 id="访问测试"><a href="#访问测试" class="header-anchor">#</a> 访问测试</h3> <ol><li>启动 keepalived 之前，先使用命令 <code>ip a</code>，查看 <code>192.168.200.133</code> 和 <code>192.168.200.122</code> 这两台服务器的 IP 情况</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129162240.png" alt="1604599529242"></p> <ol start="2"><li>分别启动两台服务器的 keepalived</li></ol> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /usr/local/sbin

./keepalived
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>再次通过 <code>ip a</code> 查看 IP</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129162308.png" alt="1604599616821"></p> <p>此时发现服务器 A 多出了 <code>192.168.200.222</code>，正是配置的虚拟路由 VIP，而服务器 B 并没有，说明服务器 A 是 Master，优先级高于服务器 B。</p> <ol start="3"><li>当把 <code>192.168.200.133</code> 服务器 A 上的 keepalived 关闭后，再次查看 IP</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129162648.png" alt="1604599709822"></p> <p>说明当 Master 服务器 A 宕机后，服务器 B 由 Backup 晋升为 Master。</p> <p>通过上述的测试，我们会发现，虚拟 IP(VIP)会在 Master 节点上，当 Master 节点上的 keepalived 出问题以后，因为 Backup 无法收到 Master 发出的 VRRP 状态通过信息，就会直接升为 Master 。VIP 也会「漂移」到新的 Master 。</p> <p><strong>上面测试和 Nginx 有什么关系?</strong></p> <p>我们把 <code>192.168.200.133</code> 服务器 A 的 keepalived 再次启动下，由于它的优先级高于 <code>192.168.200.122</code> 服务器 B，所有它会再次成为 Master，VIP 也会「漂移」过去。</p> <p>我们通过浏览器访问：</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//192.168.200.222/</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129163014.png" alt="1604600079149"></p> <p>如果把 <code>192.168.200.133</code> 服务器 A 的 keepalived 进程关闭掉</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">kill</span> keepalived 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>再次访问相同的地址，效果如图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129163225.png" alt="1604600145318"></p> <p>虽然效果成功实现了，但是此时是我们手动把服务器上的 keepalived 关闭，才让 VIP 进行切换。</p> <p><strong>而什么时候关闭 keepalived 呢？</strong></p> <p>应该是在 keepalived 所在服务器的 Nginx 出现问题后，把 keepalived 关闭掉，就可以让 VIP 执行另外一台服务器。<strong>但是现在这所有的操作都是通过手动来完成的</strong>，我们如何能让系统自动判断当前服务器的 Nginx 是否正确启动，如果没有，要能让 VIP 自动进行「漂移」，这个问题该如何解决？往下看。</p> <h3 id="vrrp-script"><a href="#vrrp-script" class="header-anchor">#</a> vrrp_script</h3> <p>keepalived 只能做到对网络故障和 keepalived 本身的监控，即当出现网络故障或者 keepalived 本身出现问题时，进行切换。但是这些还不够，我们还需要监控 keepalived 所在服务器上的其他业务，比如 Nginx，如果 Nginx 出现异常了，而 keepalived 却保持正常，是无法完成系统的正常工作的，因此需要根据业务进程的运行状态决定是否需要进行主备切换，这个时候，我们可以通过编写脚本对业务进程进行检测监控。</p> <p>首先我们要知道 keepalived 的 vrrp_script 的配置模板：</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">vrrp_script</span> 脚本名称</span>
<span class="token punctuation">{</span>
    script &quot;脚本位置&quot;
    interval 3 <span class="token comment"># 执行时间间隔</span>
    weight -20 <span class="token comment"># 动态调整 vrrp_instance 的优先级</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>实现步骤：</p> <ul><li><p>编写脚本，这里的脚本名是 <code>ck_nginx.sh</code>，位置在 <code>/etc/keepalived</code> 路径下</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">num</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> <span class="token parameter variable">-C</span> nginx --no-header <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">`</span></span>  <span class="token comment"># 查询 Nginx 的进程数</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$num</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>       	       <span class="token comment"># 如果 Nginx 的进程数等于 0</span>
/usr/local/nginx/sbin/nginx			   <span class="token comment"># 则可执行文件 nginx，启动 Nginx 服务</span>

<span class="token function">sleep</span> <span class="token number">2</span>								   <span class="token comment"># 阻塞 2 秒 </span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> <span class="token parameter variable">-C</span> nginx --no-header <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">`</span></span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token comment"># 再次查询 Nginx 的进程数</span>
<span class="token function">killall</span> keepalived		<span class="token comment"># 如果 Nginx 的进程数不等于 0，则杀死 keepalived 进程</span>

<span class="token keyword">fi</span>
<span class="token keyword">fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li><p>ps 命令用于显示当前进程 (process) 的状态。</p></li> <li><p>-C(command)：指定命令的所有进程</p></li> <li><p>--no-header：排除标题</p></li></ul> <p>命令的效果如图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211129164825.png" alt="image-20211129164825064"></p> <p>代表目前的 num = 3。</p> <p>这个脚本其实就是判断 Nginx 是否启动还是宕机了，如果没有启动，则重新启动。重新启动后再次查看 Nginx 是否启动成功，如果没有启动，说明 Nginx 宕机了，则杀死 keepalived 进程，这样，另一台服务器的 Nginx 就晋升为 Master。</p></li> <li><p>为脚本文件设置权限</p></li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">chmod</span> <span class="token number">755</span> ck_nginx.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p>将脚本添加到 Master 服务器 A 的 keepalived 的配置文件里</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /etc/keepalived/keepalived.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>添加如下内容：</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">vrrp_script</span> ck_nginx</span> <span class="token punctuation">{</span>
   script &quot;/etc/keepalived/ck_nginx.sh&quot; <span class="token comment"># 执行脚本的位置</span>
   interval 2		<span class="token comment"># 执行脚本的周期，秒为单位</span>
   weight -20		<span class="token comment"># 权重的计算方式</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">vrrp_instance</span> VI_1</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">state</span> MASTER
    interface ens33
    virtual_router_id <span class="token number">10</span>
    priority <span class="token number">100</span>
    advert_int <span class="token number">1</span>
    authentication</span> <span class="token punctuation">{</span>
        auth_type PASS
        auth_pass 1111
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">virtual_ipaddress</span></span> <span class="token punctuation">{</span>
        192.168.200.111
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">track_script</span></span> <span class="token punctuation">{</span>
      ck_nginx
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li><p>如果效果没有出来，可以使用 <code>tail -f /var/log/messages</code> 查看日志信息，找对应的错误信息</p></li> <li><p>两个 Nginx 启动后，关闭 Master 的 Nginx，通过 <code>ip a</code> 查看 Backup 的 Nginx 的IP，是否晋升为 Master</p></li></ul> <p><strong>问题思考</strong></p> <p>通常如果 Master 服务死掉后，Backup 会变成 Master，但是当原来的 Master 服务又恢复了，它会和原来的 Backup 会抢占 VIP，这样就会发生两次切换，这对业务繁忙的网站来说是不好的。所以我们要在配置文件加入 nopreempt 非抢占，但是这个参数只能用于 Backup 的服务器，所以我们在用配置的时候，最好 Master 和 Backup 的 state 都设置成 Backup，这样它们只能通过 priority 优先级来竞争。</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Somnus711/Somnus711.github.io/edit/master/docs/30.框架/50.高性能服务器 - Nginx/21.Nginx - 部署与集群.md" target="_blank" rel="noopener noreferrer">编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=Nginx" title="标签">#Nginx</a></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2025/04/06, 01:04:59</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/nginx/cache-integration/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Nginx - 缓存集成</div></a> <a href="/nginx/site-auth/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Nginx - 站点与认证</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/nginx/cache-integration/" class="prev">Nginx - 缓存集成</a></span> <span class="next"><a href="/nginx/site-auth/">Nginx - 站点与认证</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/ep/magic-change/"><div>
            技术随笔 - Element Plus 修改包名
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">11-02</span></dt></dl><dl><dd>02</dd> <dt><a href="/reactor/extensibility/"><div>
            Reactor - 扩展性
            <!----></div></a> <span class="date">11-02</span></dt></dl><dl><dd>03</dd> <dt><a href="/reactor/best-practices/"><div>
            Reactor - 最佳实践
            <!----></div></a> <span class="date">11-02</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:haoyuan1996@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Somnus711" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2025
    <span>Somnus Haoyuan | <a href="https://github.com/Somnus711/Somnus711.github.io/blob/main/LICENSE" target="_blank">MIT
            License</a><br />
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802034042"
            style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img
                src="https://cdn.jsdelivr.net/gh/Somnus711/picx-image-hosting@master/blog-pic/备案图标.3ph98jsceq0w.webp" style="float:left;" />
            <span>京公网安备 11010802034042号</span>
        </a>
        <a target="_blank" href="https://beian.miit.gov.cn"
            style="display:inline-block;text-decoration:none;height:20px;line-height:20px;padding-left: 10px;">
            <span>京ICP备2025120692号-1</span></a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><div></div><div></div><div id="tcomment"></div><!----><div></div></div></div>
    <script src="/assets/js/app.40d6eb57.js" defer></script><script src="/assets/js/2.84f16386.js" defer></script><script src="/assets/js/236.c8e24b2a.js" defer></script><script src="/assets/js/15.107d5767.js" defer></script><script src="/assets/js/5.1ffba6c1.js" defer></script><script src="/assets/js/9.dba8a9bf.js" defer></script><script src="/assets/js/12.3f1ed9aa.js" defer></script>
  </body>
</html>
